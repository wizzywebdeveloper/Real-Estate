<!doctype html>
<html lang="en" class="h-full">
<head>
  <head>
   <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real Estate Platform - Find Your Dream Home</title>

  <!-- Tailwind & Fonts -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <!-- ðŸ‘‡ Main script where you use Supabase -->
 <script type="module" src="./supabase.js"></script>

  <script>
    // This prevents "ReferenceError: supabase is not defined" 
    // while the module is still loading.
    window.supabase = window.supabase || {};
  </script>
</head>

  
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      box-sizing: border-box;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in-up {
      animation: fadeInUp 0.6s ease-out forwards;
    }

    .property-card {
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }

    .property-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
    }

    .property-card:hover .property-image {
      transform: scale(1.05);
    }

    .property-image {
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .filter-chip {
      transition: all 0.2s ease;
    }

    .filter-chip:hover {
      transform: translateY(-2px);
    }

    .hero-gradient {
      background: linear-gradient(135deg, rgba(37, 99, 235, 0.95) 0%, rgba(99, 102, 241, 0.95) 100%);
    }

    .glass-effect {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
    }

    .social-icon {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .social-icon:hover {
      transform: translateY(-4px);
    }

    .logo-container {
      display: inline-flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 48px;
      height: 48px;
      background: white;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 20px;
    }

    .serif-heading {
      font-family: 'Playfair Display', serif;
    }

    .sans-body {
      font-family: 'Inter', sans-serif;
    }

    .carousel-container {
      position: relative;
      overflow: hidden;
    }

    .carousel-slides {
      display: flex;
      transition: transform 0.5s ease-in-out;
    }

    .carousel-slide {
      min-width: 100%;
      height: 200px;
    }

    .carousel-dots {
      position: absolute;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 6px;
      z-index: 10;
    }

    .carousel-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255,255,255,0.5);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .carousel-dot.active {
      background: white;
      width: 24px;
      border-radius: 4px;
    }

    .carousel-arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0, 0, 0, 0.5);
      color: white;
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      transition: all 0.3s ease;
      font-size: 18px;
      font-weight: bold;
    }

    .carousel-arrow:hover {
      background: rgba(0, 0, 0, 0.8);
      transform: translateY(-50%) scale(1.1);
    }

    .carousel-arrow-left {
      left: 12px;
    }

    .carousel-arrow-right {
      right: 12px;
    }

    .chat-widget {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 1000;
      font-family: 'Inter', sans-serif;
    }

    .chat-button {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #2563eb 0%, #6366f1 100%);
      color: white;
      border: none;
      cursor: pointer;
      box-shadow: 0 8px 24px rgba(37, 99, 235, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      transition: all 0.3s ease;
      position: relative;
    }

    .chat-button:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(37, 99, 235, 0.5);
    }

    .chat-button.unread::after {
      content: '';
      position: absolute;
      top: 8px;
      right: 8px;
      width: 12px;
      height: 12px;
      background: #ef4444;
      border-radius: 50%;
      border: 2px solid white;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.1); }
    }

    .chat-window {
      position: fixed;
      bottom: 100px;
      right: 24px;
      width: 380px;
      max-width: calc(100vw - 48px);
      height: 550px;
      max-height: calc(100vh - 150px);
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transform-origin: bottom right;
      animation: chatOpen 0.3s ease-out;
    }

    @keyframes chatOpen {
      from {
        opacity: 0;
        transform: scale(0.8) translateY(20px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .chat-header {
      background: linear-gradient(135deg, #2563eb 0%, #6366f1 100%);
      color: white;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      background: #f9fafb;
    }

    .chat-message {
      margin-bottom: 16px;
      display: flex;
      gap: 12px;
      animation: messageSlide 0.3s ease-out;
    }

    @keyframes messageSlide {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .chat-message.user {
      flex-direction: row-reverse;
    }

    .message-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      flex-shrink: 0;
    }

    .message-content {
      max-width: 70%;
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 14px;
      line-height: 1.5;
    }

    .chat-message.agent .message-content {
      background: white;
      color: #111827;
      border-bottom-left-radius: 4px;
    }

    .chat-message.user .message-content {
      background: #2563eb;
      color: white;
      border-bottom-right-radius: 4px;
    }

    .message-time {
      font-size: 11px;
      opacity: 0.6;
      margin-top: 4px;
    }

    .typing-indicator {
      display: flex;
      gap: 4px;
      padding: 12px 16px;
      background: white;
      border-radius: 12px;
      width: fit-content;
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #9ca3af;
      animation: typing 1.4s infinite;
    }

    .typing-dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-10px); }
    }

    .chat-input-container {
      padding: 16px;
      background: white;
      border-top: 1px solid #e5e7eb;
      display: flex;
      gap: 12px;
    }

    .chat-input {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 24px;
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s;
    }

    .chat-input:focus {
      border-color: #2563eb;
    }

    .chat-send-button {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: #2563eb;
      color: white;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      transition: all 0.2s;
      flex-shrink: 0;
    }

    .chat-send-button:hover {
      background: #1d4ed8;
      transform: scale(1.05);
    }

    .chat-send-button:disabled {
      background: #d1d5db;
      cursor: not-allowed;
      transform: scale(1);
    }

    .quick-replies {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    .quick-reply-button {
      padding: 8px 14px;
      background: white;
      color: #2563eb;
      border: 2px solid #2563eb;
      border-radius: 20px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 600;
    }

    .quick-reply-button:hover {
      background: #2563eb;
      color: white;
    }

    @media (max-width: 768px) {
      .property-card {
        margin-bottom: 16px;
      }
      
      .filter-chip {
        font-size: 14px;
        padding: 8px 16px;
      }

      .logo-icon {
        width: 36px;
        height: 36px;
        font-size: 16px;
      }

      .chat-widget {
        bottom: 16px;
        right: 16px;
      }

      .chat-window {
        bottom: 84px;
        right: 16px;
        width: calc(100vw - 32px);
        height: calc(100vh - 120px);
      }

      .chat-button {
        width: 56px;
        height: 56px;
        font-size: 24px;
      }
    }
  </style>
    <style>@view-transition { navigation: auto; }</style>
  </head>
  <body 
  class="h-full">
    <div id="app" class="w-full h-full overflow-auto"></div>

   
  <script>
        let agentProperties = [];

        function normalizeAgentProperty(row) {
        return {
          id: "agent-" + row.id,
          title: row.title,
          price: Number(row.price) || 0,
          type: row.type || "sale",
          images: Array.isArray(row.images) && row.images.length
            ? row.images
            : [row.image_url],
          bedrooms: Number(row.bedrooms) || 0,
          bathrooms: Number(row.bathrooms) || 0,
          sqft: Number(row.sqft) || 0,
          city: row.city || "",
          state: row.state || "",
          location: row.location || "",
          description: row.description || "",
          agent: row.agent_name || row.agent || "Luxe Estates",
          phone: row.phone || "",
          email: row.email || "",
          lat: row.lat || null,
          lng: row.lng || null,
          featured: false,
          rating: row.rating || 5,
          views: 0,
          saves: 0,
          source: "agent"
        };
      }

        function renderStars(rating) {
      const fullStars = Math.floor(rating);
      const hasHalfStar = rating % 1 >= 0.5;
      let starsHtml = '';
      
      // Add yellow stars
      for (let i = 0; i < 5; i++) {
        if (i < fullStars) {
          starsHtml += '<span style="color: #f59e0b;">â˜…</span>';
        } else if (i === fullStars && hasHalfStar) {
          starsHtml += '<span style="color: #f59e0b;">Â½</span>'; // Simplified half star
        } else {
          starsHtml += '<span style="color: #e5e7eb;">â˜…</span>'; // Gray empty star
        }
      }
      return starsHtml;
    }


    const defaultConfig = {
      background_color: "#ffffff",
      card_background: "#f9fafb",
      text_color: "#111827",
      primary_action: "#2563eb",
      accent_color: "#6366f1",
      font_family: "Inter",
      font_size: 16,
      site_title: "LUXE ESTATES",
      site_tagline: "Curated Premium Properties",
      hero_headline: "Find Your Perfect Home with AI-Powered Search",
      primary_cta: "List or sale Your Property",
      secondary_cta: "Schedule Tour",
      search_placeholder: "Try: Self-contained room near downtown or 3-bed house with pool",
      filter_title: "Refine Your Search",
      logo_text: "LUXE",
      company_tagline: "Your trusted real estate partner since 2010",
      footer_about: "We connect people with their dream homes through innovative technology and personalized service.",
      contact_address: "123 Real Estate Ave, Suite 100, New York, NY 10001",
      contact_phone: "(555) 100-2000",
      contact_email: "info@luxeestates.com"
    };

    const agents = [
      {
        id: 1,
        name: "Michael Sterling",
        is_verified: true,
        verified_date: "2025-10-15",
        rating: 4.8, // Added rating
        email: "michael@luxeestates.com",
        phone: "(555) 123-4567",
        photo: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cdefs%3E%3ClinearGradient id='ag1' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%232563eb;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%236366f1;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23ag1)' width='200' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='64' font-weight='700' fill='white' text-anchor='middle' dy='.3em' font-family='Inter, sans-serif'%3EMS%3C/text%3E%3C/svg%3E"
      },
      {
        id: 2,
        name: "Sophia Laurent",
        is_verified: true,
        verified_date: "2025-10-15",
        email: "sophia@luxeestates.com",
        phone: "(555) 234-5678",
        photo: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cdefs%3E%3ClinearGradient id='ag2' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2310b981;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23059669;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23ag2)' width='200' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='64' font-weight='700' fill='white' text-anchor='middle' dy='.3em' font-family='Inter, sans-serif'%3ESL%3C/text%3E%3C/svg%3E"
      },
      {
        id: 3,
        name: "David Chen",
        email: "david@luxeestates.com",
        phone: "(555) 345-6789",
        photo: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cdefs%3E%3ClinearGradient id='ag3' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23f59e0b;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23d97706;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23ag3)' width='200' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='64' font-weight='700' fill='white' text-anchor='middle' dy='.3em' font-family='Inter, sans-serif'%3EDC%3C/text%3E%3C/svg%3E"
      },
      {
        id: 4,
        name: "Emily Rodriguez",
        email: "emily@luxeestates.com",
        phone: "(555) 456-7890",
        photo: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cdefs%3E%3ClinearGradient id='ag4' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23ec4899;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23db2777;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23ag4)' width='200' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='64' font-weight='700' fill='white' text-anchor='middle' dy='.3em' font-family='Inter, sans-serif'%3EER%3C/text%3E%3C/svg%3E"
      }
    ];

    // Function to add lat/lng to properties
    function addLocationData(properties) {
      const cityCoords = {
        'Lagos, Lagos': { lat: 6.5244, lng: 3.3792 },
        'Abuja, FCT': { lat: 9.0765, lng: 7.3986 },
        'Ibadan, Oyo': { lat: 7.3775, lng: 3.9470 },
        'Port Harcourt, Rivers': { lat: 4.8156, lng: 7.0498 },
        'Kano, Kano': { lat: 12.0022, lng: 8.5920 },
        'Enugu, Enugu': { lat: 6.5244, lng: 7.5110 },
        'Kaduna, Kaduna': { lat: 10.5105, lng: 7.4165 },
        'Benin City, Edo': { lat: 6.3350, lng: 5.6037 },
        'Calabar, Cross River': { lat: 4.9758, lng: 8.3417 },
        'Owerri, Imo': { lat: 5.4840, lng: 7.0351 },
        'Jos, Plateau': { lat: 9.8965, lng: 8.8583 },
        'Abeokuta, Ogun': { lat: 7.1475, lng: 3.3619 },
        'Akure, Ondo': { lat: 7.2571, lng: 5.2058 },
        'Ilorin, Kwara': { lat: 8.4799, lng: 4.5418 },
        'Maiduguri, Borno': { lat: 11.8333, lng: 13.1500 },
        'Nsukka, Enugu': { lat: 6.8567, lng: 7.3958 },
        'Zaria, Kaduna': { lat: 11.0667, lng: 7.7000 },
        'Ife, Osun': { lat: 7.4815, lng: 4.5600 },
        'Uyo, Akwa Ibom': { lat: 5.0378, lng: 7.9085 },
        'Makurdi, Benue': { lat: 7.7333, lng: 8.5333 },
        'Awka, Anambra': { lat: 6.2106, lng: 7.0720 },
        'Asaba, Delta': { lat: 6.1987, lng: 6.7337 },
        'Warri, Delta': { lat: 5.5167, lng: 5.7500 },
        'Osogbo, Osun': { lat: 7.7715, lng: 4.5562 },
        'Ado-Ekiti, Ekiti': { lat: 7.6211, lng: 5.2220 },
        'Bauchi, Bauchi': { lat: 10.3158, lng: 9.8442 },
        'Yola, Adamawa': { lat: 9.2093, lng: 12.4306 },
        'Sokoto, Sokoto': { lat: 13.0622, lng: 5.2339 },
        'Lokoja, Kogi': { lat: 7.7974, lng: 6.7397 },
        'Jalingo, Taraba': { lat: 8.8833, lng: 11.3500 },
        'Lafia, Nasarawa': { lat: 8.4833, lng: 8.5167 },
        'Minna, Niger': { lat: 9.6139, lng: 6.5569 },
        'Gombe, Gombe': { lat: 10.2904, lng: 11.1711 },
        'Abakaliki, Ebonyi': { lat: 6.3250, lng: 8.1137 },
        'Umuahia, Abia': { lat: 5.5250, lng: 7.4833 },
        'Yenagoa, Bayelsa': { lat: 4.9267, lng: 6.2676 },
        'Ikeja, Lagos': { lat: 6.5966, lng: 3.3515 },
        'Victoria Island, Lagos': { lat: 6.4281, lng: 3.4219 }
      };
      
      return properties.map(prop => {
        const key = `${prop.city}, ${prop.state}`;
        const coords = cityCoords[key] || { lat: 9.0820, lng: 8.6753 };
        const offset = (Math.random() - 0.5) * 0.02;
        return {
          ...prop,
          lat: coords.lat + offset,
          lng: coords.lng + offset
        };
      });
    }

    const propertiesBase = [
      // BUDGET - SELF-CONTAINED ROOMS (Room Self Contain)
      {
        id: 201,
        title: "Cozy Self-Contained Studio Room",
        type: "rent",
        price: 85000,
        location: "University Area",
        city: "Nsukka",
        state: "Enugu",
        bedrooms: 0,
        bathrooms: 1,
        sqft: 280,
        description: "Affordable self-contained room with private entrance, kitchenette, and bathroom. Perfect for students or young professionals. Includes WiFi and utilities. Close to University of Nigeria campus.",
        images: [
          "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g201a' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%238b5cf6;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%236d28d9;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g201a)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EMain Room%3C/text%3E%3C/svg%3E",
          "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g201b' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23a78bfa;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%238b5cf6;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g201b)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EKitchenette%3C/text%3E%3C/svg%3E",
          "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g201c' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23c4b5fd;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23a78bfa;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g201c)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EBathroom%3C/text%3E%3C/svg%3E",
          "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g201d' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%237c3aed;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%235b21b6;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g201d)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EEntrance%3C/text%3E%3C/svg%3E",
          "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g201e' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%239333ea;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%237c3aed;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g201e)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3ECloset%3C/text%3E%3C/svg%3E",
          "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g201f' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23a855f7;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%239333ea;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g201f)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EWindow View%3C/text%3E%3C/svg%3E",
          "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g201g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23c084fc;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23a855f7;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g201g)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EBuilding%3C/text%3E%3C/svg%3E",
          "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g201h' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23ddd6fe;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23c084fc;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g201h)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3ENeighborhood%3C/text%3E%3C/svg%3E"
        ],
        agent: "Emily Rodriguez",
        agentId: 4,
        phone: "(555) 456-7890",
        email: "emily@luxeestates.com",
        status: "approved",
        views: 89,
        saves: 23,
        walkScore: 92,
        transitScore: 88,
        schoolScore: 75,
        virtual3D: false,
        featured: false
      },



      {
        id: 202,
        title: "Private Self-Contained Room Near Campus",
        type: "rent",
        price: 95000,
        location: "University Area",
        city: "Zaria",
        state: "Kaduna",
        bedrooms: 0,
        bathrooms: 1,
        sqft: 320,
        description: "Self-contained room with separate entrance, mini kitchen, and private bathroom. Quiet neighborhood, parking included. Walking distance to Ahmadu Bello University and shopping centers.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g202' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2314b8a6;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%230d9488;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g202)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EQuiet Retreat%3C/text%3E%3C/svg%3E"],
        agent: "David Chen",
        agentId: 3,
        phone: "(555) 345-6789",
        email: "david@luxeestates.com",
        status: "approved",
        views: 112,
        saves: 34,
        walkScore: 78,
        transitScore: 72,
        schoolScore: 91,
        virtual3D: false,
        featured: false
      },
      {
        id: 203,
        title: "Modern Self-Contained Room Downtown",
        type: "rent",
        price: 120000,
        location: "City Center",
        city: "Abuja",
        state: "FCT",
        bedrooms: 0,
        bathrooms: 1,
        sqft: 350,
        description: "Newly renovated self-contained room in vibrant Wuse 2 area. Features include modern appliances, high-speed internet, and 24/7 security. Perfect for digital nomads.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g203' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23ef4444;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23dc2626;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g203)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EUrban Living%3C/text%3E%3C/svg%3E"],
        agent: "Emily Rodriguez",
        agentId: 4,
        phone: "(555) 456-7890",
        email: "emily@luxeestates.com",
        status: "approved",
        views: 145,
        saves: 41,
        walkScore: 95,
        transitScore: 92,
        schoolScore: 80,
        virtual3D: false,
        featured: false
      },

      // BUDGET RENTALS - 1 Bedroom
      {
        id: 101,
        title: "Cozy Downtown Studio Apartment",
        type: "rent",
        price: 180000,
        location: "City Center",
        city: "Ikeja",
        state: "Lagos",
        bedrooms: 1,
        bathrooms: 1,
        sqft: 550,
        description: "Self-contained one-bedroom in the heart of Ikeja GRA. Perfect for young professionals. Features modern kitchenette, walk-in closet, and access to building gym. Walking distance to Allen Avenue and Maryland.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g101' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%236b7280;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%234b5563;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g101)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EStudio Living%3C/text%3E%3C/svg%3E"],
        agent: "Emily Rodriguez",
        agentId: 4,
        phone: "(555) 456-7890",
        email: "emily@luxeestates.com",
        status: "approved",
        views: 145,
        saves: 32,
        walkScore: 96,
        transitScore: 94,
        schoolScore: 78,
        virtual3D: false,
        featured: false
      },
      {
        id: 102,
        title: "Suburban Garden Apartment",
        type: "rent",
        price: 145000,
        location: "Residential",
        city: "Ibadan",
        state: "Oyo",
        bedrooms: 1,
        bathrooms: 1,
        sqft: 650,
        description: "Charming one-bedroom self-contained unit with private entrance. Ground floor with small patio garden. Includes all utilities, internet, and parking. Pet-friendly community near University of Ibadan.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g102' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2384cc16;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%2365a30d;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g102)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EGarden Retreat%3C/text%3E%3C/svg%3E"],
        agent: "David Chen",
        agentId: 3,
        phone: "(555) 345-6789",
        email: "david@luxeestates.com",
        status: "approved",
        views: 98,
        saves: 21,
        walkScore: 72,
        transitScore: 65,
        schoolScore: 88,
        virtual3D: false,
        featured: false
      },
      {
        id: 204,
        title: "Waterfront One-Bedroom Cottage",
        type: "rent",
        price: 195000,
        location: "Waterfront",
        city: "Calabar",
        state: "Cross River",
        bedrooms: 1,
        bathrooms: 1,
        sqft: 580,
        description: "Charming one-bedroom cottage with Calabar River views. Features include updated kitchen, cozy living area, and small deck. Steps from marina road and local eateries.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g204' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2306b6d4;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%230891b2;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g204)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3ERiver Cottage%3C/text%3E%3C/svg%3E"],
        agent: "Sophia Laurent",
        is_verified: true,
        agentId: 2,
        phone: "(555) 234-5678",
        email: "sophia@luxeestates.com",
        status: "approved",
        views: 167,
        saves: 52,
        walkScore: 84,
        transitScore: 78,
        schoolScore: 82,
        virtual3D: false,
        featured: false
      },

      // BUDGET RENTALS - 2 Bedroom
      {
        id: 103,
        title: "Modern Two-Bedroom Apartment",
        type: "rent",
        price: 280000,
        location: "City Center",
        city: "Abuja",
        state: "FCT",
        bedrooms: 2,
        bathrooms: 1,
        sqft: 900,
        description: "Bright and airy two-bedroom apartment with updated appliances. Open floor plan, in-unit laundry, and balcony with city views. Close to Berger junction and shopping centers.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g103' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%235b21b6;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%234c1d95;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g103)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EModern Living%3C/text%3E%3C/svg%3E"],
        agent: "Emily Rodriguez",
        agentId: 4,
        phone: "(555) 456-7890",
        email: "emily@luxeestates.com",
        status: "approved",
        views: 176,
        saves: 45,
        walkScore: 89,
        transitScore: 91,
        schoolScore: 82,
        virtual3D: false,
        featured: false
      },
      {
        id: 104,
        title: "Suburban Family Apartment",
        type: "rent",
        price: 235000,
        location: "Residential",
        city: "Enugu",
        state: "Enugu",
        bedrooms: 2,
        bathrooms: 2,
        sqft: 1050,
        description: "Spacious two-bedroom, two-bath apartment in family-friendly Independence Layout. Features include covered parking, storage unit, and playground access. Near excellent schools and parks.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g104' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23059669;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23047857;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g104)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EFamily Friendly%3C/text%3E%3C/svg%3E"],
        agent: "David Chen",
        agentId: 3,
        phone: "(555) 345-6789",
        email: "david@luxeestates.com",
        status: "approved",
        views: 134,
        saves: 38,
        walkScore: 76,
        transitScore: 71,
        schoolScore: 94,
        virtual3D: false,
        featured: false
      },
      {
        id: 205,
        title: "Waterfront Two-Bedroom Loft",
        type: "rent",
        price: 320000,
        location: "Waterfront",
        city: "Port Harcourt",
        state: "Rivers",
        bedrooms: 2,
        bathrooms: 1,
        sqft: 950,
        description: "Industrial-chic loft with harbor views in Old GRA. High ceilings, exposed brick, and modern kitchen. Building includes gym and rooftop terrace. Walking distance to marina and restaurants.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g205' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%233b82f6;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%232563eb;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g205)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EHarbor Loft%3C/text%3E%3C/svg%3E"],
        agent: "Sophia Laurent",
        is_verified: true,
        agentId: 2,
        phone: "(555) 234-5678",
        email: "sophia@luxeestates.com",
        status: "approved",
        views: 198,
        saves: 64,
        walkScore: 91,
        transitScore: 86,
        schoolScore: 79,
        virtual3D: false,
        featured: false
      },

      // BUDGET SALES - 1 Bedroom
      {
        id: 105,
        title: "Starter Condo Downtown",
        type: "sale",
        price: 28500000,
        location: "City Center",
        city: "Lagos",
        state: "Lagos",
        bedrooms: 1,
        bathrooms: 1,
        sqft: 620,
        description: "Perfect first home! This self-contained condo in Lekki Phase 1 features granite countertops, stainless appliances, and tiled floors. Building amenities include fitness center and rooftop deck. Low service charge.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g105' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23dc2626;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23b91c1c;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g105)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EStarter Home%3C/text%3E%3C/svg%3E"],
        agent: "Emily Rodriguez",
        agentId: 4,
        phone: "(555) 456-7890",
        email: "emily@luxeestates.com",
        status: "approved",
        views: 203,
        saves: 67,
        walkScore: 92,
        transitScore: 88,
        schoolScore: 79,
        virtual3D: false,
        featured: false
      },
      {
        id: 206,
        title: "Suburban One-Bedroom Condo",
        type: "sale",
        price: 22000000,
        location: "Residential",
        city: "Owerri",
        state: "Imo",
        bedrooms: 1,
        bathrooms: 1,
        sqft: 680,
        description: "Affordable one-bedroom condo in quiet World Bank area. Updated kitchen and bathroom, new flooring throughout. Community pool and clubhouse. Great for first-time buyers or investors.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g206' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2322c55e;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%2316a34a;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g206)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EAffordable Living%3C/text%3E%3C/svg%3E"],
        agent: "David Chen",
        agentId: 3,
        phone: "(555) 345-6789",
        email: "david@luxeestates.com",
        status: "approved",
        views: 156,
        saves: 48,
        walkScore: 68,
        transitScore: 62,
        schoolScore: 85,
        virtual3D: false,
        featured: false
      },

      // MID-RANGE RENTALS - 3 Bedroom
      {
        id: 106,
        title: "Spacious Waterfront Townhouse",
        type: "rent",
        price: 480000,
        location: "Waterfront",
        city: "Uyo",
        state: "Akwa Ibom",
        bedrooms: 3,
        bathrooms: 2,
        sqft: 1650,
        description: "Beautiful three-bedroom townhouse with creek views in Ewet Housing Estate. Features include updated kitchen, private garage, and small backyard. Walking distance to waterfront and dining. Pet-friendly.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g106' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2306b6d4;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%230891b2;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g106)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EMarina Views%3C/text%3E%3C/svg%3E"],
        agent: "Sophia Laurent",
        is_verified: true,
        agentId: 2,
        phone: "(555) 234-5678",
        email: "sophia@luxeestates.com",
        status: "approved",
        views: 267,
        saves: 89,
        walkScore: 85,
        transitScore: 78,
        schoolScore: 86,
        virtual3D: true,
        featured: false
      },
      {
        id: 107,
        title: "Executive Suburban Home",
        type: "rent",
        price: 425000,
        location: "Residential",
        city: "Jos",
        state: "Plateau",
        bedrooms: 3,
        bathrooms: 2,
        sqft: 1800,
        description: "Elegant three-bedroom home in prestigious Rayfield neighborhood. Features include chef's kitchen, boys' quarters, two-car garage, and landscaped compound. Top-rated school district.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g107' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%237c3aed;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%236d28d9;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g107)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EExecutive Living%3C/text%3E%3C/svg%3E"],
        agent: "David Chen",
        agentId: 3,
        phone: "(555) 345-6789",
        email: "david@luxeestates.com",
        status: "approved",
        views: 198,
        saves: 71,
        walkScore: 68,
        transitScore: 72,
        schoolScore: 97,
        virtual3D: true,
        featured: false
      },
      {
        id: 207,
        title: "Downtown Three-Bedroom Penthouse",
        type: "rent",
        price: 520000,
        location: "City Center",
        city: "Victoria Island",
        state: "Lagos",
        bedrooms: 3,
        bathrooms: 2,
        sqft: 1900,
        description: "Luxury three-bedroom penthouse with panoramic lagoon views in Eko Atlantic. Floor-to-ceiling windows, gourmet kitchen, and private balcony. Building features concierge, gym, and pool.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g207' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23a855f7;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%239333ea;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g207)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EPenthouse Living%3C/text%3E%3C/svg%3E"],
        agent: "Michael Sterling", 
        is_verified: true,
        agentId: 1,
        phone: "(555) 123-4567",
        email: "michael@luxeestates.com",
        status: "approved",
        views: 312,
        saves: 98,
        walkScore: 97,
        transitScore: 95,
        schoolScore: 84,
        virtual3D: true,
        featured: false
      },

      // MID-RANGE SALES - 2 & 3 Bedroom
      {
        id: 108,
        title: "Renovated Two-Bedroom Condo",
        type: "sale",
        price: 62000000,
        location: "City Center",
        city: "Abuja",
        state: "FCT",
        bedrooms: 2,
        bathrooms: 2,
        sqft: 1100,
        description: "Completely renovated condo with high-end finishes in Maitama. Features include quartz counters, custom cabinets, luxury flooring, and walk-in closets. Includes parking spot and storage.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g108' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23f59e0b;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23d97706;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g108)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3ERenovated Elegance%3C/text%3E%3C/svg%3E"],
        agent: "Michael Sterling",
        is_verified: true,
        agentId: 1,
        phone: "(555) 123-4567",
        email: "michael@luxeestates.com",
        status: "approved",
        views: 289,
        saves: 92,
        walkScore: 93,
        transitScore: 89,
        schoolScore: 84,
        virtual3D: true,
        featured: false
      },
      {
        id: 109,
        title: "Charming Suburban Colonial",
        type: "sale",
        price: 75000000,
        location: "Residential",
        city: "Kaduna",
        state: "Kaduna",
        bedrooms: 3,
        bathrooms: 2,
        sqft: 2100,
        description: "Classic colonial home with modern updates in Barnawa Estate. Features tiled floors throughout, updated kitchen with island, master suite with spa bath, and fenced compound. Excellent schools.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g109' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2315803d;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23166534;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g109)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EColonial Charm%3C/text%3E%3C/svg%3E"],
        agent: "David Chen",
        agentId: 3,
        phone: "(555) 345-6789",
        email: "david@luxeestates.com",
        status: "approved",
        views: 245,
        saves: 78,
        walkScore: 74,
        transitScore: 68,
        schoolScore: 95,
        virtual3D: true,
        featured: false
      },
      {
        id: 208,
        title: "Waterfront Two-Bedroom Villa",
        type: "sale",
        price: 98000000,
        location: "Waterfront",
        city: "Warri",
        state: "Delta",
        bedrooms: 2,
        bathrooms: 2,
        sqft: 1450,
        description: "Stunning waterfront villa with jetty access in Effurun. Open concept living, chef's kitchen, and screened porch. Estate includes pool, tennis courts, and private waterfront access.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g208' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%230ea5e9;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%230284c7;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g208)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EWaterfront Villa%3C/text%3E%3C/svg%3E"],
        agent: "Sophia Laurent",
        is_verified: true,
        agentId: 2,
        phone: "(555) 234-5678",
        email: "sophia@luxeestates.com",
        status: "approved",
        views: 334,
        saves: 112,
        walkScore: 72,
        transitScore: 65,
        schoolScore: 88,
        virtual3D: true,
        featured: false
      },

      // MID-RANGE - 4+ Bedroom
      {
        id: 209,
        title: "Spacious Four-Bedroom Suburban Home",
        type: "sale",
        price: 110000000,
        location: "Residential",
        city: "Asaba",
        state: "Delta",
        bedrooms: 4,
        bathrooms: 3,
        sqft: 2800,
        description: "Beautiful four-bedroom family home with pool and outdoor kitchen in Summit Estate. Open floor plan, gourmet kitchen, home office, and master retreat. Walking distance to top-rated schools.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g209' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2322c55e;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%2316a34a;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g209)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EFamily Paradise%3C/text%3E%3C/svg%3E"],
        agent: "David Chen",
        agentId: 3,
        phone: "(555) 345-6789",
        email: "david@luxeestates.com",
        status: "approved",
        views: 312,
        saves: 95,
        walkScore: 71,
        transitScore: 66,
        schoolScore: 96,
        virtual3D: true,
        featured: false
      },

      // LUXURY RENTALS - 4+ Bedroom
      {
        id: 112,
        title: "Estate Home with Pool",
        type: "rent",
        price: 750000,
        location: "Residential",
        city: "Ikoyi",
        state: "Lagos",
        bedrooms: 4,
        bathrooms: 3,
        sqft: 3200,
        description: "Stunning estate home in Banana Island featuring resort-style pool, outdoor kitchen, game room, and home office. Gated community with excellent amenities. Top-rated schools nearby.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g112' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23be185d;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%239f1239;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g112)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EEstate Living%3C/text%3E%3C/svg%3E"],
        agent: "David Chen",
        agentId: 3,
        phone: "(555) 345-6789",
        email: "david@luxeestates.com",
        status: "approved",
        views: 334,
        saves: 98,
        walkScore: 62,
        transitScore: 58,
        schoolScore: 98,
        virtual3D: true,
        featured: false
      },
      {
        id: 210,
        title: "Luxury Waterfront Estate",
        type: "rent",
        price: 1200000,
        location: "Waterfront",
        city: "Yenagoa",
        state: "Bayelsa",
        bedrooms: 5,
        bathrooms: 4,
        sqft: 4200,
        description: "Exclusive waterfront estate with private jetty and creek access. Features include chef's kitchen, wine cellar, home theater, infinity pool, and guest house. Breathtaking sunset views.",
        images: [
          "img/5bedroom8.jpeg",
          "img/5bedroom1.jpeg",
          "img/5bedroom2.jpeg",
          "img/5bedroom3.jpeg",
          "img/5bedroom4.jpeg",
          "img/5bedroom5.jpeg",
          "img/5bedroom6.jpeg",
          "img/5bedroom7.jpeg"

        
        ],
        agent: "Sophia Laurent",
        is_verified: true,
        agentId: 2,
        phone: "(555) 234-5678",
        email: "sophia@luxeestates.com",
        status: "approved",
        views: 567,
        saves: 189,
        walkScore: 54,
        transitScore: 48,
        schoolScore: 91,
        virtual3D: true,
        featured: true
      },

      // LUXURY SALES
      {
        id: 1,
        title: "Modern Downtown Penthouse",
        type: "sale",
        price: 285000000,
        location: "City Center",
        city: "Lagos",
        state: "Lagos",
        bedrooms: 3,
        bathrooms: 3,
        sqft: 2400,
        description: "Stunning penthouse in Eko Atlantic with panoramic ocean views, chef's kitchen, and private rooftop terrace. Floor-to-ceiling windows flood the space with natural light. Smart home technology throughout.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g1' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%232d3748;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%231a202c;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g1)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='32' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3ELuxury Penthouse%3C/text%3E%3C/svg%3E"],
        agent: "Michael Sterling",
        is_verified: true,
        agentId: 1,
        phone: "(555) 123-4567",
        email: "michael@luxeestates.com",
        status: "approved",
        views: 542,
        saves: 189,
        walkScore: 95,
        transitScore: 92,
        schoolScore: 88,
        virtual3D: true,
        featured: true
      },
      {
        id: 2,
        title: "Waterfront Villa Estate",
        type: "sale",
        price: 650000000,
        location: "Waterfront",
        city: "Calabar",
        state: "Cross River",
        bedrooms: 5,
        bathrooms: 6,
        sqft: 6500,
        description: "Spectacular waterfront estate with private jetty, infinity pool, home theater, and wine cellar. Direct marina access and breathtaking sunset views. Guest house and outdoor entertainment area.",
        images: 
        ["img/campus-self-contain1.jpg",
        "img/campus-self-contain2.jpg",
        "img/campus-self-contain3.jpg",
        "img/campus-self-contain4.jpg",
        "img/campus-self-contain5.jpg",
        "img/campus-self-contain6.jpg",
        "img/campus-self-contain7.jpg",
        "img/campus-self-contain8.jpg",
        
        ],
        agent: "Sophia Laurent",
        is_verified: true,
        agentId: 2,
        phone: "(555) 234-5678",
        email: "sophia@luxeestates.com",
        status: "approved",
        views: 721,
        saves: 256,
        walkScore: 72,
        transitScore: 68,
        schoolScore: 92,
        virtual3D: true,
        featured: true
      },


      {
        id: 3,
        title: "Contemporary Suburban Masterpiece",
        type: "sale",
        price: 250000000,
        location: "Residential",
        city: "Abuja",
        state: "FCT",
        bedrooms: 4,
        bathrooms: 4,
        sqft: 4200,
        description: "Award-winning architecture in Asokoro with smart home technology, gourmet kitchen, spa-like bathrooms, and professionally landscaped compound with outdoor kitchen and fire pit.",
        images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g3' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%234a5568;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%232d3748;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g3)' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='32' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3EContemporary Home%3C/text%3E%3C/svg%3E"],
        agent: "David Chen",
        agentId: 3,
        phone: "(555) 345-6789",
        email: "david@luxeestates.com",
        status: "approved",
        views: 487,
        saves: 172,
        walkScore: 85,
        transitScore: 78,
        schoolScore: 96,
        virtual3D: true,
        featured: true
      },
      {
        id: 211,
        
        title: "Oceanfront Luxury Villa",
        type: "sale",
        price: 890000000,
        location: "Waterfront",
        city: "Benin City",
        state: "Edo",
        bedrooms: 6,
        bathrooms: 7,
        sqft: 7200,
        description: "Ultra-luxury waterfront villa with 180-degree views. Features include elevator, home gym, spa, wine room, theater, and infinity pool. Private creek access and smart home integration.",
        images: [ "img/Luxury-3bdm1.jpg",
                  "img/Luxury-3bdm2.jpg",
                  "img/Luxury-3bdm3.jpg",
                  "img/Luxury-3bdm4.jpg",
                  "img/Luxury-3bdm5.jpg",
                  "img/Luxury-3bdm6.jpg",
                  "img/Luxury-3bdm1.jpg",
                  "img/Luxury-3bdm1.jpg"],
        agent: "Sophia Laurent",
        is_verified: true,
        agentId: 2,
        phone: "(555) 234-5678",
        email: "sophia@luxeestates.com",
        status: "approved",
        views: 892,
        saves: 298,
        walkScore: 48,
        transitScore: 42,
        schoolScore: 94,
        virtual3D: true,
        featured: true
      }
    ];

    const properties = addLocationData(propertiesBase);

    let currentFilters = {
      type: 'all',
      location: 'all',
      priceRange: 'all',
      bedrooms: 'all',
      aiSearch: '',
      citySearch: '',
      stateSearch: ''
    };

    let userSubmittedProperties = [];
    let currentView = 'listings';
    let selectedProperty = null;
    let isSubmitting = false;
    let sortBy = 'featured';
    let carouselIntervals = {};
    let searchDebounceTimer = null;
    let chatOpen = false;
    let chatMessages = [];
    let isTyping = false;
    let hasUnreadMessages = false;

        function render() {
        // 1. Capture the search state
        const searchInput = document.getElementById('ai-search-input');
        const query = searchInput ? searchInput.value.toLowerCase() : '';

        // 2. Combine your data sources
        const allAvailable = [...properties, ...userSubmittedProperties];

        // 3. Apply the combined filter
        filteredProps = allAvailable.filter(prop => {
            // Basic keyword matching
            const matchesText = prop.title.toLowerCase().includes(query) || 
                              prop.city.toLowerCase().includes(query) ||
                              prop.location.toLowerCase().includes(query);

            // Intent matching (AI-style logic)
            let maxPrice = Infinity;
            if (query.includes('cheap')) maxPrice = 1000000;
            
            const bedroomMatch = query.match(/(\d+)\s*(bed|bedroom)/);
            const requiredBeds = bedroomMatch ? parseInt(bedroomMatch[1]) : null;
            
            const matchesPrice = prop.price <= maxPrice;
            const matchesBeds = requiredBeds ? prop.bedrooms >= requiredBeds : true;

            // Valid if text matches OR intent matches (only if query is meaningful)
            return matchesText || (matchesPrice && matchesBeds && query.length > 3);
        });

        // 4. Update the Grid
        const grid = document.getElementById('properties-grid');
        if (grid) {
            if (filteredProps.length === 0) {
                grid.innerHTML = `<div style="grid-column: 1/-1; text-align: center; padding: 40px;">No properties found for "${query}".</div>`;
            } else {
                // Your existing logic to map filteredProps to HTML cards
                grid.innerHTML = filteredProps.map(prop => renderPropertyCard(prop)).join('');
            }
        }
        
        // ... rest of your UI restoration logic (like cursor focus) ...
    }

    function initCarousel(propertyId, totalSlides) {
      let currentSlide = 0;
      
      if (carouselIntervals[propertyId]) {
        clearInterval(carouselIntervals[propertyId]);
      }
      
      carouselIntervals[propertyId] = setInterval(() => {
        currentSlide = (currentSlide + 1) % totalSlides;
        updateCarousel(propertyId, currentSlide);
      }, 2000);
    }
    

    function updateCarousel(propertyId, slideIndex) {
      const slidesContainer = document.getElementById(`carousel-slides-${propertyId}`);
      const dots = document.querySelectorAll(`#carousel-dots-${propertyId} .carousel-dot`);
      
      if (slidesContainer) {
        slidesContainer.style.transform = `translateX(-${slideIndex * 100}%)`;
      }
      
      dots.forEach((dot, index) => {
        if (index === slideIndex) {
          dot.classList.add('active');
        } else {
          dot.classList.remove('active');
        }
      });
    }

    function goToSlide(propertyId, slideIndex, totalSlides) {
      updateCarousel(propertyId, slideIndex);
      
      if (carouselIntervals[propertyId]) {
        clearInterval(carouselIntervals[propertyId]);
      }
      
      let currentSlide = slideIndex;
      carouselIntervals[propertyId] = setInterval(() => {
        currentSlide = (currentSlide + 1) % totalSlides;
        updateCarousel(propertyId, currentSlide);
      }, 2000);
    }

    window.carouselNext = function(propertyId, totalSlides) {
      const slidesContainer = document.getElementById(`carousel-slides-${propertyId}`);
      if (!slidesContainer) return;
      
      const currentTransform = slidesContainer.style.transform || 'translateX(0%)';
      const currentSlide = Math.abs(parseInt(currentTransform.match(/-?\d+/)?.[0] || 0) / 100);
      const nextSlide = (currentSlide + 1) % totalSlides;
      
      goToSlide(propertyId, nextSlide, totalSlides);
    };

    window.carouselPrev = function(propertyId, totalSlides) {
      const slidesContainer = document.getElementById(`carousel-slides-${propertyId}`);
      if (!slidesContainer) return;
      
      const currentTransform = slidesContainer.style.transform || 'translateX(0%)';
      const currentSlide = Math.abs(parseInt(currentTransform.match(/-?\d+/)?.[0] || 0) / 100);
      const prevSlide = (currentSlide - 1 + totalSlides) % totalSlides;
      
      goToSlide(propertyId, prevSlide, totalSlides);
    };

    function stopCarousel(propertyId) {
      if (carouselIntervals[propertyId]) {
        clearInterval(carouselIntervals[propertyId]);
        delete carouselIntervals[propertyId];
      }
    }

       function renderPropertyCard(prop) {
    // Ensure we are working with an array
    const images = Array.isArray(prop.images) && prop.images.length > 0 
                   ? prop.images 
                   : [prop.image_url];
    
    const carouselId = `carousel_${prop.id}`;
    let currentIndex = 0;

    // Use a small delay to ensure the HTML exists in the DOM before animating
    setTimeout(() => {
        const track = document.getElementById(`track-${carouselId}`);
        // Only start the timer if there is more than 1 image
        if (track && images.length > 1) {
            setInterval(() => {
                currentIndex = (currentIndex + 1) % images.length;
                // Move the track based on current index
                track.style.transform = `translateX(-${currentIndex * 100}%)`;
            }, 2000); // 2 seconds
        }
    }, 500);

    return `
    <div class="relative h-64 overflow-hidden rounded-t-xl group">
        <div id="track-${carouselId}" style="display: flex; width: 100%; height: 100%; transition: transform 0.7s ease-in-out;">
            ${images.map(img => `
                <img src="${img}" class="w-full h-full flex-shrink-0 object-cover" style="width: 100%; flex: 0 0 100%;">
            `).join('')}
        </div>
    </div>
    `;
}

    function stopCarousel(propertyId) {
      if (carouselIntervals[propertyId]) {
        clearInterval(carouselIntervals[propertyId]);
        delete carouselIntervals[propertyId];
      }
    }

    function generatePropertyImages(baseId, colors) {
      const labels = ['Main View', 'Kitchen', 'Bathroom', 'Bedroom', 'Living Area', 'Exterior', 'Amenities', 'Neighborhood'];
      return labels.map((label, index) => {
        const color1 = colors[index % colors.length];
        const color2 = colors[(index + 1) % colors.length];
        return `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Cdefs%3E%3ClinearGradient id='g${baseId}${String.fromCharCode(97 + index)}' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:${encodeURIComponent(color1)};stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:${encodeURIComponent(color2)};stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g${baseId}${String.fromCharCode(97 + index)})' width='800' height='600'/%3E%3Ctext x='50%25' y='50%25' font-size='28' font-weight='600' fill='white' text-anchor='middle' dy='.3em' font-family='Playfair Display, serif'%3E${encodeURIComponent(label)}%3C/text%3E%3C/svg%3E`;
      });
    }

    function formatPrice(price, type) {
      if (type === 'rent') {
        return `â‚¦${price.toLocaleString()}/mo`;
      }
      return `â‚¦${price.toLocaleString()}`;
    }

    function filterProperties() {
      const approvedSubmissions = userSubmittedProperties.filter(p => p.status === 'approved').map(p => ({
        ...p,
        views: p.views || 0,
        saves: p.saves || 0,
        walkScore: 75,
        transitScore: 70,
        schoolScore: 80,
        virtual3D: false,
        featured: false
      }));
      
      let allProperties = [...properties, ...approvedSubmissions];
      
      if (currentFilters.aiSearch.trim()) {
        const searchTerm = currentFilters.aiSearch.toLowerCase();
        allProperties = allProperties.filter(prop => {
          const searchableText = `${prop.title} ${prop.description} ${prop.location} ${prop.city} ${prop.state} ${prop.bedrooms}bed ${prop.type}`.toLowerCase();
          
          const selfContainedMatch = (searchTerm.includes('self') || searchTerm.includes('contained') || searchTerm.includes('self-contained')) && prop.bedrooms === 0;
          const poolMatch = searchTerm.includes('pool') && prop.description.toLowerCase().includes('pool');
          const modernMatch = searchTerm.includes('modern') && (prop.title.toLowerCase().includes('modern') || prop.description.toLowerCase().includes('modern'));
          const schoolMatch = searchTerm.includes('school') && prop.schoolScore >= 85;
          const bedroomMatch = searchTerm.match(/(\d+)[\s-]*(bed|bedroom)/i);
          
          if (bedroomMatch) {
            const beds = parseInt(bedroomMatch[1]);
            if (prop.bedrooms !== beds) return false;
          }
          
          return searchableText.includes(searchTerm) || selfContainedMatch || poolMatch || modernMatch || schoolMatch;
        });
      }

      if (currentFilters.citySearch.trim()) {
        const cityTerm = currentFilters.citySearch.toLowerCase();
        allProperties = allProperties.filter(p => p.city.toLowerCase().includes(cityTerm));
      }

      if (currentFilters.stateSearch.trim()) {
        const stateTerm = currentFilters.stateSearch.toLowerCase();
        allProperties = allProperties.filter(p => p.state.toLowerCase().includes(stateTerm));
      }
      
      if (currentFilters.type !== 'all') {
        allProperties = allProperties.filter(p => p.type === currentFilters.type);
      }
      
      if (currentFilters.location !== 'all') {
        allProperties = allProperties.filter(p => p.location === currentFilters.location);
      }
      
      if (currentFilters.bedrooms !== 'all') {
        if (currentFilters.bedrooms === 'self-contained') {
          allProperties = allProperties.filter(p => p.bedrooms === 0);
        } else {
          const beds = parseInt(currentFilters.bedrooms);
          if (beds >= 4) {
            allProperties = allProperties.filter(p => p.bedrooms >= 4);
          } else {
            allProperties = allProperties.filter(p => p.bedrooms === beds);
          }
        }
      }
      
      if (currentFilters.priceRange !== 'all') {
        allProperties = allProperties.filter(prop => {
          const price = prop.price;
          if (prop.type === 'rent') {
            if (currentFilters.priceRange === 'low' && price > 300000) return false;
            if (currentFilters.priceRange === 'medium' && (price <= 300000 || price > 600000)) return false;
            if (currentFilters.priceRange === 'high' && price <= 600000) return false;
          } else {
            if (currentFilters.priceRange === 'low' && price > 50000000) return false;
            if (currentFilters.priceRange === 'medium' && (price <= 50000000 || price > 150000000)) return false;
            if (currentFilters.priceRange === 'high' && price <= 150000000) return false;
          }
          return true;
        });
      }
      
      if (sortBy === 'featured') {
        allProperties.sort((a, b) => {
          if (a.featured && !b.featured) return -1;
          if (!a.featured && b.featured) return 1;
          return b.views - a.views;
        });
      } else if (sortBy === 'price-low') {
        allProperties.sort((a, b) => a.price - b.price);
      } else if (sortBy === 'price-high') {
        allProperties.sort((a, b) => b.price - a.price);
      } else if (sortBy === 'newest') {
        allProperties.sort((a, b) => new Date(b.submittedAt || 0) - new Date(a.submittedAt || 0));
      }
      
      return allProperties;
    }

    window.setFilter = function(filterType, value) {
      currentFilters[filterType] = value;
      render();
    };

    window.setSort = function(value) {
      sortBy = value;
      render();
    };

    window.switchView = function(view, data = null) {
      // Stop all carousels when switching views
      Object.keys(carouselIntervals).forEach(id => stopCarousel(parseInt(id)));
      
      currentView = view;
      
      if (view === 'property') {
        selectedProperty = data;
      } else {
        selectedProperty = null;
      }
      
      render();
      if (view === 'property' || view === 'submit') {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    };

    window.saveProperty = function(propertyId) {
      showToast('Property saved to your favorites!', 'success');
    };

    window.shareProperty = function(propertyId) {
      showToast('Property link copied to clipboard!', 'success');
    };

    window.submitProperty = async function() {
      if (isSubmitting) return;

      const title = document.getElementById('property-title').value.trim();
      const type = document.getElementById('property-type').value;
      const price = parseFloat(document.getElementById('property-price').value);
      const location = document.getElementById('property-location').value;
      const city = document.getElementById('property-city').value.trim();
      const state = document.getElementById('property-state').value.trim();
      const bedrooms = parseInt(document.getElementById('property-bedrooms').value);
      const bathrooms = parseInt(document.getElementById('property-bathrooms').value);
      const sqft = parseInt(document.getElementById('property-sqft').value);
      const description = document.getElementById('property-description').value.trim();
      const agent = document.getElementById('property-agent').value.trim();
      const phone = document.getElementById('property-phone').value.trim();
      const email = document.getElementById('property-email').value.trim();

      if (!title || !type || !price || !location || !city || !state || isNaN(bedrooms) || !bathrooms || !sqft || !description || !agent || !phone || !email) {
        showToast('Please fill in all required fields', 'error');
        return;
      }

      if (userSubmittedProperties.length >= 999) {
        showToast('Maximum limit of 999 properties reached. Please contact admin.', 'error');
        return;
      }

      isSubmitting = true;
      render();

      const propertyData = {
        title,
        type,
        price,
        location,
        city,
        state,
        bedrooms,
        bathrooms,
        sqft,
        description,
        agent,
        phone,
        email,
        status: 'pending',
        submittedAt: new Date().toISOString(),
        views: 0,
        saves: 0
      };

      const result = await window.dataSdk.create(propertyData);

      isSubmitting = false;

      if (result.isOk) {
        showToast('Property submitted successfully! Awaiting admin approval.', 'success');
        currentView = 'listings';
        render();
      } else {
        showToast('Failed to submit property. Please try again.', 'error');
        render();
      }
    };

    

    window.scheduleTour = function(property) {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 20px; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px);';
      
      const config = window.elementSdk?.config || defaultConfig;
      const baseSize = config.font_size || defaultConfig.font_size;
      
      modal.innerHTML = `
        <div class="glass-effect" style="padding: 40px; border-radius: 16px; max-width: 500px; width: 100%; box-shadow: 0 25px 50px rgba(0,0,0,0.2);">
          <h3 class="serif-heading" style="font-size: ${baseSize * 1.75}px; font-weight: 700; margin: 0 0 8px 0; color: ${config.text_color};">Schedule a Tour</h3>
          <p class="sans-body" style="font-size: ${baseSize}px; color: ${config.text_color}; opacity: 0.7; margin: 0 0 32px 0;">${property.title}</p>

          
          
          <div style="margin-bottom: 20px;">
            <label for="tour-name" class="sans-body" style="font-size: ${baseSize * 0.875}px; color: ${config.text_color}; display: block; margin-bottom: 8px; font-weight: 600;">Your Name</label>
            <input id="tour-name" type="text" placeholder="Enter your name" class="sans-body" style="font-size: ${baseSize}px; width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; outline: none; transition: border-color 0.2s;" onfocus="this.style.borderColor='${config.primary_action}'" onblur="this.style.borderColor='#e5e7eb'" />
          </div>
          
          <div style="margin-bottom: 20px;">
            <label for="tour-email" class="sans-body" style="font-size: ${baseSize * 0.875}px; color: ${config.text_color}; display: block; margin-bottom: 8px; font-weight: 600;">Email</label>
            <input id="tour-email" type="email" placeholder="your@email.com" class="sans-body" style="font-size: ${baseSize}px; width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; outline: none; transition: border-color 0.2s;" onfocus="this.style.borderColor='${config.primary_action}'" onblur="this.style.borderColor='#e5e7eb'" />
          </div>
          
          <div style="margin-bottom: 20px;">
            <label for="tour-phone" class="sans-body" style="font-size: ${baseSize * 0.875}px; color: ${config.text_color}; display: block; margin-bottom: 8px; font-weight: 600;">Phone</label>
            <input id="tour-phone" type="tel" placeholder="(555) 123-4567" class="sans-body" style="font-size: ${baseSize}px; width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; outline: none; transition: border-color 0.2s;" onfocus="this.style.borderColor='${config.primary_action}'" onblur="this.style.borderColor='#e5e7eb'" />
          </div>
          
          <div style="margin-bottom: 32px;">
            <label for="tour-date" class="sans-body" style="font-size: ${baseSize * 0.875}px; color: ${config.text_color}; display: block; margin-bottom: 8px; font-weight: 600;">Preferred Date</label>
            <input id="tour-date" type="date" class="sans-body" style="font-size: ${baseSize}px; width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; outline: none; transition: border-color 0.2s;" onfocus="this.style.borderColor='${config.primary_action}'" onblur="this.style.borderColor='#e5e7eb'" />
          </div>
          
          <div style="display: flex; gap: 12px;">
            <button onclick="this.closest('.modal-overlay').remove()" class="sans-body" style="font-size: ${baseSize}px; flex: 1; padding: 14px; background: #e5e7eb; color: ${config.text_color}; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: background 0.2s;" onmouseover="this.style.background='#d1d5db'" onmouseout="this.style.background='#e5e7eb'">Cancel</button>
            <button onclick="confirmTour(this)" class="sans-body" style="font-size: ${baseSize}px; flex: 1; padding: 14px; background: ${config.primary_action}; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: opacity 0.2s;" onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">Confirm Tour</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    };
    

    window.confirmTour = function(button) {
      const name = document.getElementById('tour-name').value;
      const email = document.getElementById('tour-email').value;
      const phone = document.getElementById('tour-phone').value;
      const date = document.getElementById('tour-date').value;

      if (!name || !email || !phone || !date) {
        showToast('Please fill in all fields', 'error');
        return;
      }

      button.closest('.modal-overlay').remove();
      showToast('Tour scheduled successfully! We\'ll contact you soon.', 'success');
    };

    window.contactAgent = function(property) {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 20px; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px);';
      
      const config = window.elementSdk?.config || defaultConfig;
      const baseSize = config.font_size || defaultConfig.font_size;
      
      modal.innerHTML = `
        <div class="glass-effect" style="padding: 40px; border-radius: 16px; max-width: 500px; width: 100%; box-shadow: 0 25px 50px rgba(0,0,0,0.2);">
          <h3 class="serif-heading" style="font-size: ${baseSize * 1.75}px; font-weight: 700; margin: 0 0 8px 0; color: ${config.text_color};">Contact Agent</h3>
          <p class="sans-body" style="font-size: ${baseSize}px; color: ${config.text_color}; opacity: 0.7; margin: 0 0 24px 0;">${property.agent_name} â€¢ ${property.phone}</p>
          
          <div style="margin-bottom: 20px;">
            <label for="contact-name" class="sans-body" style="font-size: ${baseSize * 0.875}px; color: ${config.text_color}; display: block; margin-bottom: 8px; font-weight: 600;">Your Name</label>
            <input id="contact-name" type="text" placeholder="Enter your name" class="sans-body" style="font-size: ${baseSize}px; width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; outline: none;" />
          </div>
          
          <div style="margin-bottom: 20px;">
            <label for="contact-email" class="sans-body" style="font-size: ${baseSize * 0.875}px; color: ${config.text_color}; display: block; margin-bottom: 8px; font-weight: 600;">Email</label>
            <input id="contact-email" type="email" placeholder="your@email.com" class="sans-body" style="font-size: ${baseSize}px; width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; outline: none;" />
          </div>
          
          <div style="margin-bottom: 24px;">
            <label for="contact-message" class="sans-body" style="font-size: ${baseSize * 0.875}px; color: ${config.text_color}; display: block; margin-bottom: 8px; font-weight: 600;">Message</label>
            <textarea id="contact-message" placeholder="I'm interested in this property..." class="sans-body" style="font-size: ${baseSize}px; width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; outline: none; min-height: 120px; resize: vertical;"></textarea>
          </div>
          
          <div style="display: flex; gap: 12px;">
            <button onclick="this.closest('.modal-overlay').remove()" class="sans-body" style="font-size: ${baseSize}px; flex: 1; padding: 14px; background: #e5e7eb; color: ${config.text_color}; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Cancel</button>
            <button onclick="sendMessage(this)" class="sans-body" style="font-size: ${baseSize}px; flex: 1; padding: 14px; background: ${config.primary_action}; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Send Message</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    };

    window.sendMessage = function(button) {
      const name = document.getElementById('contact-name').value;
      const email = document.getElementById('contact-email').value;
      const message = document.getElementById('contact-message').value;

      if (!name || !email || !message) {
        showToast('Please fill in all fields', 'error');
        return;
      }

      button.closest('.modal-overlay').remove();
      showToast('Message sent successfully!', 'success');
    };

    window.toggleChat = function() {
      chatOpen = !chatOpen;
      if (chatOpen) {
        hasUnreadMessages = false;
        if (chatMessages.length === 0) {
          // Welcome message
          chatMessages.push({
            type: 'agent',
            name: 'Support Agent',
            text: 'Hello! Welcome to Luxe Estates. How can I help you today?',
            time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
            showQuickReplies: true
          });
        }
      }
      render();
    };

    window.sendChatMessage = function() {
      const input = document.getElementById('chat-input');
      const message = input.value.trim();
      
      if (!message) return;

      // Add user message
      chatMessages.push({
        type: 'user',
        text: message,
        time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
      });

      input.value = '';
      isTyping = true;
      render();

      // Simulate agent response
      setTimeout(() => {
        const response = getAutoResponse(message);
        chatMessages.push({
          type: 'agent',
          name: 'Support Agent',
          text: response,
          time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
        });
        isTyping = false;
        
        if (!chatOpen) {
          hasUnreadMessages = true;
        }
        
        render();
        
        // Scroll to bottom
        setTimeout(() => {
          const messagesContainer = document.getElementById('chat-messages');
          if (messagesContainer) {
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
          }
        }, 100);
      }, 1500 + Math.random() * 1000);

      // Scroll to bottom
      setTimeout(() => {
        const messagesContainer = document.getElementById('chat-messages');
        if (messagesContainer) {
          messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
      }, 100);
    };

    window.sendQuickReply = function(message) {
      const input = document.getElementById('chat-input');
      if (input) {
        input.value = message;
        sendChatMessage();
      }
    };

    function getAutoResponse(message) {
      const lowerMessage = message.toLowerCase();
      
      if (lowerMessage.includes('price') || lowerMessage.includes('cost') || lowerMessage.includes('afford')) {
        return "We have properties ranging from â‚¦22M to â‚¦890M for sale, and â‚¦85,000 to â‚¦1.2M per month for rentals. You can use our filters to find properties within your budget. Would you like me to help you find something specific?";
      } else if (lowerMessage.includes('tour') || lowerMessage.includes('visit') || lowerMessage.includes('view')) {
        return "I'd be happy to help you schedule a property tour! You can click the 'Schedule Tour' button on any property page, or tell me which property you're interested in and I'll arrange it for you.";
      } else if (lowerMessage.includes('location') || lowerMessage.includes('where') || lowerMessage.includes('area')) {
        return "We have properties across Nigeria in 36 states including Lagos, Abuja, Port Harcourt, Ibadan, Enugu, and many more cities. We also have listings near major universities. Which area interests you?";
      } else if (lowerMessage.includes('bedroom') || lowerMessage.includes('bed') || lowerMessage.includes('room')) {
        return "Our listings range from self-contained studio rooms perfect for students, to luxury 6-bedroom estates. Use the bedroom filter to narrow down your search. How many bedrooms are you looking for?";
      } else if (lowerMessage.includes('agent') || lowerMessage.includes('contact')) {
        return "Each property has a dedicated agent you can contact directly. Click on any property and use the 'Contact Agent' button to reach out. They typically respond within a few hours!";
      } else if (lowerMessage.includes('list') || lowerMessage.includes('sell') || lowerMessage.includes('submit')) {
        return "To List or sale Your Property, click the 'List or sale Your Property' button at the top of the page. Fill out the form with your property details and our team will review it within 24-48 hours.";
      } else if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
        return "Hello! I'm here to help you find your perfect property. Are you looking to buy or rent? Any specific location or property type in mind?";
      } else if (lowerMessage.includes('thank')) {
        return "You're very welcome! Feel free to reach out anytime if you have more questions. Happy house hunting! ðŸ¡";
      } else {
        return "Thanks for your message! Our support team specializes in helping you find the perfect property. You can browse our listings, schedule tours, or contact agents directly through the platform. Is there anything specific I can help you with?";
      }
    }

    function showToast(message, type) {
      const toast = document.createElement('div');
      const bgColor = type === 'error' ? '#ef4444' : '#10b981';
      toast.className = 'sans-body';
      toast.style.cssText = `position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: ${bgColor}; color: white; padding: 16px 28px; border-radius: 12px; z-index: 2000; font-size: 15px; font-weight: 500; box-shadow: 0 10px 25px rgba(0,0,0,0.2);`;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3500);
    }

    function renderHeader(config, baseSize) {
      return `
        <div style="background: ${config.background_color}; border-bottom: 2px solid #e5e7eb; padding: 16px 24px; position: sticky; top: 0; z-index: 100;">
          <div style="max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
            <div class="logo-container" onclick="switchView('listings')" style="cursor: pointer;">
              <div class="logo-icon" style="background: linear-gradient(135deg, ${config.primary_action} 0%, ${config.accent_color} 100%); color: white;">
                <span class="serif-heading">${config.logo_text || defaultConfig.logo_text}</span>
              </div>
              <div>
                <h2 class="serif-heading" style="font-size: ${baseSize * 1.25}px; font-weight: 800; margin: 0; color: ${config.text_color};">${config.site_title || defaultConfig.site_title}</h2>
                <p class="sans-body" style="font-size: ${baseSize * 0.75}px; color: ${config.text_color}; opacity: 0.6; margin: 0;">${config.company_tagline || defaultConfig.company_tagline}</p>
              </div>
            </div>
            
            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
              <button onclick="switchView('listings')" class="sans-body" style="padding: 10px 20px; background: ${currentView === 'listings' ? config.primary_action : 'transparent'}; color: ${currentView === 'listings' ? 'white' : config.text_color}; border: 2px solid ${config.primary_action}; border-radius: 8px; font-size: ${baseSize * 0.875}px; font-weight: 600; cursor: pointer;">Properties</button>
                <a href="login.html" class="sans-body" style="padding: 10px 20px; background: ${config.accent_color}; color: white; border:   none; border-radius: 8px; font-size: ${baseSize * 0.875}px; font-weight: 600; text-decoration: none; display: inline-block; cursor: pointer;">
                  ${config.primary_cta || defaultConfig.primary_cta}
              </a>
            </div>
          </div>
        </div>
      `;
    }

    

    function renderFooter(config, baseSize) {
      return `
        <footer style="background: linear-gradient(135deg, ${config.text_color} 0%, #1f2937 100%); color: white; padding: 60px 24px 24px 24px; margin-top: 80px;">
          <div style="max-width: 1400px; margin: 0 auto;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 40px; margin-bottom: 48px;">
              <div>
                <div class="logo-container" style="margin-bottom: 20px;">
                  <div class="logo-icon" style="background: white; color: ${config.primary_action};">
                    <span class="serif-heading">${config.logo_text || defaultConfig.logo_text}</span>
                  </div>
                  <h3 class="serif-heading" style="font-size: ${baseSize * 1.25}px; font-weight: 800; margin: 0; color: white;">${config.site_title || defaultConfig.site_title}</h3>
                </div>
                <p class="sans-body" style="font-size: ${baseSize * 0.875}px; color: white; opacity: 0.8; line-height: 1.6; margin: 0 0 20px 0;">${config.footer_about || defaultConfig.footer_about}</p>
                
                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                  <a href="https://facebook.com" target="_blank" rel="noopener noreferrer" class="social-icon" style="background: rgba(255,255,255,0.1); text-decoration: none;" onmouseover="this.style.background='#1877f2'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                    <span style="font-size: ${baseSize * 1.25}px;">ðŸ“˜</span>
                  </a>
                  <a href="https://twitter.com" target="_blank" rel="noopener noreferrer" class="social-icon" style="background: rgba(255,255,255,0.1); text-decoration: none;" onmouseover="this.style.background='#1da1f2'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                    <span style="font-size: ${baseSize * 1.25}px;">ðŸ¦</span>
                  </a>
                  <a href="https://instagram.com" target="_blank" rel="noopener noreferrer" class="social-icon" style="background: rgba(255,255,255,0.1); text-decoration: none;" onmouseover="this.style.background='#e1306c'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                    <span style="font-size: ${baseSize * 1.25}px;">ðŸ“·</span>
                  </a>
                  <a href="https://linkedin.com" target="_blank" rel="noopener noreferrer" class="social-icon" style="background: rgba(255,255,255,0.1); text-decoration: none;" onmouseover="this.style.background='#0077b5'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                    <span style="font-size: ${baseSize * 1.25}px;">ðŸ’¼</span>
                  </a>
                  <a href="https://youtube.com" target="_blank" rel="noopener noreferrer" class="social-icon" style="background: rgba(255,255,255,0.1); text-decoration: none;" onmouseover="this.style.background='#ff0000'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                    <span style="font-size: ${baseSize * 1.25}px;">â–¶ï¸</span>
                  </a>
                </div>
              </div>

              <div>
                <h4 class="serif-heading" style="font-size: ${baseSize * 1.125}px; font-weight: 700; margin: 0 0 20px 0; color: white;">Quick Links</h4>
                <ul class="sans-body" style="list-style: none; padding: 0; margin: 0;">
                  <li style="margin-bottom: 12px;"><a href="#" onclick="event.preventDefault(); currentFilters = { type: 'all', location: 'all', priceRange: 'all', bedrooms: 'all', aiSearch: '', citySearch: '', stateSearch: '' }; switchView('listings')" style="font-size: ${baseSize * 0.875}px; color: white; opacity: 0.8; text-decoration: none; transition: opacity 0.2s; cursor: pointer;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'">Browse Properties</a></li>
                  <li style="margin-bottom: 12px;"><a href="#" onclick="event.preventDefault(); switchView('submit')" style="font-size: ${baseSize * 0.875}px; color: white; opacity: 0.8; text-decoration: none; transition: opacity 0.2s; cursor: pointer;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'">List or sale Your Property</a></li>
                  <li style="margin-bottom: 12px;"><a href="#" onclick="event.preventDefault(); showToast('About Us page coming soon!', 'success')" style="font-size: ${baseSize * 0.875}px; color: white; opacity: 0.8; text-decoration: none; transition: opacity 0.2s; cursor: pointer;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'">About Us</a></li>
                  <li style="margin-bottom: 12px;"><a href="#" onclick="event.preventDefault(); toggleChat()" style="font-size: ${baseSize * 0.875}px; color: white; opacity: 0.8; text-decoration: none; transition: opacity 0.2s; cursor: pointer;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'">Contact</a></li>
                </ul>
              </div>

              <div>
                <h4 class="serif-heading" style="font-size: ${baseSize * 1.125}px; font-weight: 700; margin: 0 0 20px 0; color: white;">Property Types</h4>
                <ul class="sans-body" style="list-style: none; padding: 0; margin: 0;">
                  <li style="margin-bottom: 12px;"><a href="#" onclick="event.preventDefault(); currentFilters = { type: 'all', location: 'all', priceRange: 'all', bedrooms: 'self-contained', aiSearch: '', citySearch: '', stateSearch: '' }; switchView('listings'); window.scrollTo({ top: 0, behavior: 'smooth' });" style="font-size: ${baseSize * 0.875}px; color: white; opacity: 0.8; text-decoration: none; transition: opacity 0.2s; cursor: pointer;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'">Self-Contained Rooms</a></li>
                  <li style="margin-bottom: 12px;"><a href="#" onclick="event.preventDefault(); currentFilters = { type: 'all', location: 'City Center', priceRange: 'all', bedrooms: 'all', aiSearch: '', citySearch: '', stateSearch: '' }; switchView('listings'); window.scrollTo({ top: 0, behavior: 'smooth' });" style="font-size: ${baseSize * 0.875}px; color: white; opacity: 0.8; text-decoration: none; transition: opacity 0.2s; cursor: pointer;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'">Downtown Condos</a></li>
                  <li style="margin-bottom: 12px;"><a href="#" onclick="event.preventDefault(); currentFilters = { type: 'all', location: 'Waterfront', priceRange: 'all', bedrooms: 'all', aiSearch: '', citySearch: '', stateSearch: '' }; switchView('listings'); window.scrollTo({ top: 0, behavior: 'smooth' });" style="font-size: ${baseSize * 0.875}px; color: white; opacity: 0.8; text-decoration: none; transition: opacity 0.2s; cursor: pointer;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'">Waterfront Estates</a></li>
                  <li style="margin-bottom: 12px;"><a href="#" onclick="event.preventDefault(); currentFilters = { type: 'all', location: 'Residential', priceRange: 'all', bedrooms: 'all', aiSearch: '', citySearch: '', stateSearch: '' }; switchView('listings'); window.scrollTo({ top: 0, behavior: 'smooth' });" style="font-size: ${baseSize * 0.875}px; color: white; opacity: 0.8; text-decoration: none; transition: opacity 0.2s; cursor: pointer;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'">Suburban Homes</a></li>
                  <li style="margin-bottom: 12px;"><a href="#" onclick="event.preventDefault(); currentFilters = { type: 'all', location: 'all', priceRange: 'high', bedrooms: 'all', aiSearch: '', citySearch: '', stateSearch: '' }; switchView('listings'); window.scrollTo({ top: 0, behavior: 'smooth' });" style="font-size: ${baseSize * 0.875}px; color: white; opacity: 0.8; text-decoration: none; transition: opacity 0.2s; cursor: pointer;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'">Luxury Properties</a></li>
                </ul>
              </div>

              <div>
                <h4 class="serif-heading" style="font-size: ${baseSize * 1.125}px; font-weight: 700; margin: 0 0 20px 0; color: white;">Contact Us</h4>
                <div class="sans-body" style="font-size: ${baseSize * 0.875}px; color: white; opacity: 0.8; line-height: 1.8;">
                  <p style="margin: 0 0 12px 0;">ðŸ“ ${config.contact_address || defaultConfig.contact_address}</p>
                  <p style="margin: 0 0 12px 0;">ðŸ“ž <a href="tel:${config.contact_phone || defaultConfig.contact_phone}" style="color: white; text-decoration: none;">${config.contact_phone || defaultConfig.contact_phone}</a></p>
                  <p style="margin: 0 0 12px 0;">ðŸ“§ <a href="mailto:${config.contact_email || defaultConfig.contact_email}" style="color: white; text-decoration: none;">${config.contact_email || defaultConfig.contact_email}</a></p>
                  <p style="margin: 16px 0 0 0; font-size: ${baseSize * 0.75}px;">â° Mon-Fri: 9AM-6PM<br/>Sat-Sun: 10AM-4PM</p>
                </div>
              </div>
            </div>

            <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 24px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
              <p class="sans-body" style="font-size: ${baseSize * 0.75}px; color: white; opacity: 0.6; margin: 0;">Â© 2024 ${config.site_title || defaultConfig.site_title}. All rights reserved.</p>
              <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                <a href="#" onclick="event.preventDefault();" class="sans-body" style="font-size: ${baseSize * 0.75}px; color: white; opacity: 0.6; text-decoration: none; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.6'">Privacy Policy</a>
                <a href="#" onclick="event.preventDefault();" class="sans-body" style="font-size: ${baseSize * 0.75}px; color: white; opacity: 0.6; text-decoration: none; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.6'">Terms of Service</a>
              </div>
            </div>
          </div>
          
        </footer>
      `;
    }

    function render() {
      const config = window.elementSdk?.config || defaultConfig;
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      
      // Save focus state
      const activeElement = document.activeElement;
      const wasSearchFocused = activeElement && activeElement.id === 'ai-search-input';
      const cursorPosition = wasSearchFocused ? activeElement.selectionStart : 0;
      
      const filteredProps = filterProperties();

      let content = '';

      content += renderHeader(config, baseSize);

      if (currentView === 'property' && selectedProperty) {
        const propertyImages = selectedProperty.images && selectedProperty.images.length >= 8 ? selectedProperty.images : generatePropertyImages(selectedProperty.id, ['#3b82f6', '#2563eb', '#1d4ed8', '#1e40af', '#1e3a8a']);
        
        content += `
          <div style="background: ${config.background_color};">
            <div style="position: relative; height: 70%; min-height: 500px; max-height: 700px; overflow: hidden;">
              <div class="carousel-container" style="width: 100%; height: 100%;">
                <div id="carousel-slides-detail" class="carousel-slides" style="height: 100%;">
                  ${propertyImages.slice(0, 8).map(img => `
                    <div class="carousel-slide" style="height: 100%;">
                      <img src="${img}" alt="${selectedProperty.title}" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.src=''; this.alt='Image failed to load';" />
                    </div>
                  `).join('')}
                </div>
                <button class="carousel-arrow carousel-arrow-left" onclick="carouselPrev('detail', 8)">â€¹</button>
                <button class="carousel-arrow carousel-arrow-right" onclick="carouselNext('detail', 8)">â€º</button>
                <div id="carousel-dots-detail" class="carousel-dots">
                  ${propertyImages.slice(0, 8).map((_, index) => `
                    <div class="carousel-dot ${index === 0 ? 'active' : ''}" onclick="goToSlide('detail', ${index}, 8)"></div>
                  `).join('')}
                </div>
              </div>
              
              <div style="position: absolute; top: 0; left: 0; right: 0; padding: 24px; background: linear-gradient(180deg, rgba(0,0,0,0.5) 0%, transparent 100%);">
                <button onclick="switchView('listings')" class="sans-body" style="background: rgba(255,255,255,0.95); color: ${config.text_color}; padding: 12px 24px; border: none; border-radius: 8px; font-size: ${baseSize}px; font-weight: 600; cursor: pointer; backdrop-filter: blur(10px);">â† Back to Listings</button>
              </div>
              
              ${selectedProperty.featured ? `
                <div style="position: absolute; top: 24px; right: 24px;">
                  <span class="sans-body" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 8px 20px; border-radius: 8px; font-size: ${baseSize * 0.875}px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);">Featured</span>
                </div>
              ` : ''}
            </div>

            <div style="max-width: 1200px; margin: 0 auto; padding: 60px 24px;">
              <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 60px; margin-bottom: 60px;">
                <div>
                  <div style="margin-bottom: 24px;">
                    <h1 class="serif-heading" style="font-size: ${baseSize * 2.5}px; font-weight: 700; margin: 0 0 16px 0; color: ${config.text_color}; line-height: 1.2;">${selectedProperty.title}</h1>
                    <p class="sans-body" style="font-size: ${baseSize * 1.125}px; color: ${config.text_color}; opacity: 0.7; margin: 0;">ðŸ“ ${selectedProperty.location} â€¢ ${selectedProperty.city}, ${selectedProperty.state}</p>
                  </div>

                  <div style="display: flex; gap: 32px; padding: 24px 0; border-top: 2px solid #e5e7eb; border-bottom: 2px solid #e5e7eb; margin-bottom: 40px; flex-wrap: wrap;">
                    <div>
                      <p class="sans-body" style="font-size: ${baseSize * 0.875}px; color: ${config.text_color}; opacity: 0.6; margin: 0 0 4px 0; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">${selectedProperty.bedrooms === 0 ? 'Self-Contained' : 'Bedrooms'}</p>
                      <p class="serif-heading" style="font-size: ${baseSize * 1.5}px; font-weight: 700; color: ${config.text_color}; margin: 0;">${selectedProperty.bedrooms === 0 ? 'Studio' : selectedProperty.bedrooms}</p>
                    </div>
                    <div>
                      <p class="sans-body" style="font-size: ${baseSize * 0.875}px; color: ${config.text_color}; opacity: 0.6; margin: 0 0 4px 0; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">Bathrooms</p>
                      <p class="serif-heading" style="font-size: ${baseSize * 1.5}px; font-weight: 700; color: ${config.text_color}; margin: 0;">${selectedProperty.bathrooms}</p>
                    </div>
                    <div>
                      <p class="sans-body" style="font-size: ${baseSize * 0.875}px; color: ${config.text_color}; opacity: 0.6; margin: 0 0 4px 0; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">Square Feet</p>
                      <p class="serif-heading" style="font-size: ${baseSize * 1.5}px; font-weight: 700; color: ${config.text_color}; margin: 0;">${selectedProperty.sqft.toLocaleString()}</p>
                    </div>
                  </div>

                  <div style="margin-bottom: 40px;">
                    <h2 class="serif-heading" style="font-size: ${baseSize * 1.5}px; font-weight: 700; margin: 0 0 16px 0; color: ${config.text_color};">Description</h2>
                    <p class="sans-body" style="font-size: ${baseSize * 1.0625}px; color: ${config.text_color}; opacity: 0.8; line-height: 1.8; margin: 0;">${selectedProperty.description}</p>
                  </div>

                  <div style="margin-bottom: 40px;">
                    <h2 class="serif-heading" style="font-size: ${baseSize * 1.5}px; font-weight: 700; margin: 0 0 16px 0; color: ${config.text_color};">ðŸ“ Location & Neighborhood</h2>
                    <div id="property-map" style="width: 100%; height: 400px; border-radius: 12px; overflow: hidden; border: 2px solid #e5e7eb; position: relative; background: #e5e7eb;">
                      <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                        <p class="sans-body" style="font-size: ${baseSize}px; color: ${config.text_color}; opacity: 0.5;">Loading map...</p>
                      </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-top: 16px;">
                      <div style="background: ${config.card_background}; padding: 16px; border-radius: 8px; text-align: center;">
                        <p class="sans-body" style="font-size: ${baseSize * 0.75}px; color: ${config.text_color}; opacity: 0.6; margin: 0 0 4px 0; text-transform: uppercase; font-weight: 600;">Walk Score</p>
                        <p class="serif-heading" style="font-size: ${baseSize * 1.5}px; font-weight: 700; color: ${config.primary_action}; margin: 0;">${selectedProperty.walkScore}/100</p>
                      </div>
                      <div style="background: ${config.card_background}; padding: 16px; border-radius: 8px; text-align: center;">
                        <p class="sans-body" style="font-size: ${baseSize * 0.75}px; color: ${config.text_color}; opacity: 0.6; margin: 0 0 4px 0; text-transform: uppercase; font-weight: 600;">Transit Score</p>
                        <p class="serif-heading" style="font-size: ${baseSize * 1.5}px; font-weight: 700; color: ${config.primary_action}; margin: 0;">${selectedProperty.transitScore}/100</p>
                      </div>
                      <div style="background: ${config.card_background}; padding: 16px; border-radius: 8px; text-align: center;">
                        <p class="sans-body" style="font-size: ${baseSize * 0.75}px; color: ${config.text_color}; opacity: 0.6; margin: 0 0 4px 0; text-transform: uppercase; font-weight: 600;">School Score</p>
                        <p class="serif-heading" style="font-size: ${baseSize * 1.5}px; font-weight: 700; color: ${config.primary_action}; margin: 0;">${selectedProperty.schoolScore}/100</p>
                      </div>
                    </div>
                  </div>
                </div>

                <div>
                  <div class="glass-effect" style="padding: 32px; border-radius: 16px; margin-bottom: 24px; border: 2px solid #e5e7eb; position: sticky; top: 100px;">
                    <p class="serif-heading" style="font-size: ${baseSize * 2.5}px; font-weight: 700; color: ${config.primary_action}; margin: 0 0 8px 0;">${formatPrice(selectedProperty.price, selectedProperty.type)}</p>
                    <p class="sans-body" style="font-size: ${baseSize}px; color: ${config.text_color}; opacity: 0.7; margin: 0 0 24px 0; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">For ${selectedProperty.type === 'rent' ? 'Rent' : 'Sale'}</p>
                    
                    <button onclick="scheduleTour(${JSON.stringify(selectedProperty).replace(/"/g, '&quot;')})" class="sans-body" style="width: 100%; padding: 16px; background: ${config.primary_action}; color: white; border: none; border-radius: 12px; font-size: ${baseSize * 1.0625}px; font-weight: 700; cursor: pointer; margin-bottom: 12px; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">ðŸ“… ${config.secondary_cta || defaultConfig.secondary_cta}</button>
                    
                    <button onclick="contactAgent(${JSON.stringify(selectedProperty).replace(/"/g, '&quot;')})" class="sans-body" style="width: 100%; padding: 16px; background: ${config.card_background}; color: ${config.text_color}; border: 2px solid ${config.primary_action}; border-radius: 12px; font-size: ${baseSize * 1.0625}px; font-weight: 700; cursor: pointer; margin-bottom: 12px; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">ðŸ’¬ Contact Agent</button>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px;">
                      <button onclick="saveProperty(${selectedProperty.id})" class="sans-body" style="padding: 12px; background: ${config.card_background}; color: ${config.text_color}; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize * 0.875}px; font-weight: 600; cursor: pointer;">â¤ï¸ Save</button>
                      <button onclick="shareProperty(${selectedProperty.id})" class="sans-body" style="padding: 12px; background: ${config.card_background}; color: ${config.text_color}; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize * 0.875}px; font-weight: 600; cursor: pointer;">ðŸ”— Share</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
      } else if (currentView === 'submit') {
        content += `
          <div style="background: ${config.background_color}; min-height: 100%;">
            <div style="max-width: 900px; margin: 0 auto; padding: 60px 24px;">
              <button onclick="switchView('listings')" class="sans-body" style="background: ${config.card_background}; color: ${config.text_color}; padding: 12px 24px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; font-weight: 600; cursor: pointer; margin-bottom: 40px;">â† Back to Listings</button>
              
              <div class="glass-effect" style="padding: 48px; border-radius: 16px; box-shadow: 0 8px 24px rgba(0,0,0,0.08);">
                <h1 class="serif-heading" style="font-size: ${baseSize * 2.5}px; font-weight: 700; margin: 0 0 12px 0; color: ${config.text_color};">${config.primary_cta || defaultConfig.primary_cta}</h1>
                <p class="sans-body" style="font-size: ${baseSize * 1.0625}px; color: ${config.text_color}; opacity: 0.7; margin: 0 0 40px 0;">Fill in the details to submit your property for listing approval</p>

                <div class="space-y-2 mb-4">
                    <div style="margin-bottom: 20px;">
                  <label class="sans-body" style="display: block; margin-bottom: 8px; font-weight: 600;">Property Images (Max 8)</label>
                  <input type="file" id="property-images" multiple accept=".jpg, .jpeg, .png, .webp"
                        onchange="previewImages(event)"
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                  <p style="font-size: 12px; color: #666; margin-top: 4px;">Select up to 8 images. These will auto-swipe every 2 seconds on your listing.</p>
                  
                  <div id="image-preview-container" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;"></div>
                </div>
                

                <form onsubmit="event.preventDefault(); submitProperty();">
                  <div style="margin-bottom: 32px;">
                    <label for="property-title" class="sans-body" style="display: block; font-size: ${baseSize * 0.875}px; font-weight: 600; margin-bottom: 8px; color: ${config.text_color};">Property Title *</label>
                    <input id="property-title" type="text" required placeholder="e.g., Modern Downtown Penthouse" class="sans-body" style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color};" />
                  </div>

                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px; margin-bottom: 32px;">
                    <div>
                      <label for="property-type" class="sans-body" style="display: block; font-size: ${baseSize * 0.875}px; font-weight: 600; margin-bottom: 8px; color: ${config.text_color};">Type *</label>
                      <select id="property-type" required class="sans-body" style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color};">
                        <option value="rent">For Rent</option>
                        <option value="sale">For Sale</option>
                      </select>
                    </div>

                    <div>
                      <label for="property-price" class="sans-body" style="display: block; font-size: ${baseSize * 0.875}px; font-weight: 600; margin-bottom: 8px; color: ${config.text_color};">Price ($) *</label>
                      <input id="property-price" type="number" required min="0" step="1" placeholder="e.g., 2500" class="sans-body" style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color};" />
                    </div>
                  </div>

                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 24px; margin-bottom: 32px;">
                    <div>
                      <label for="property-location" class="sans-body" style="display: block; font-size: ${baseSize * 0.875}px; font-weight: 600; margin-bottom: 8px; color: ${config.text_color};">Area Type *</label>
                      <select id="property-location" required class="sans-body" style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color};">
                        <option value="City Center">City Center</option>
                        <option value="Residential">Residential</option>
                        <option value="University Area">University Area</option>
                        <option value="Waterfront">Waterfront</option>
                      </select>
                    </div>

                    <div>
                      <label for="property-city" class="sans-body" style="display: block; font-size: ${baseSize * 0.875}px; font-weight: 600; margin-bottom: 8px; color: ${config.text_color};">City *</label>
                      <input id="property-city" type="text" required placeholder="e.g., New York" class="sans-body" style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color};" />
                    </div>

                    <div>
                      <label for="property-state" class="sans-body" style="display: block; font-size: ${baseSize * 0.875}px; font-weight: 600; margin-bottom: 8px; color: ${config.text_color};">State *</label>
                      <input id="property-state" type="text" required placeholder="e.g., NY" class="sans-body" style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color};" maxlength="2" />
                    </div>
                  </div>

                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 24px; margin-bottom: 32px;">
                    <div>
                      <label for="property-bedrooms" class="sans-body" style="display: block; font-size: ${baseSize * 0.875}px; font-weight: 600; margin-bottom: 8px; color: ${config.text_color};">Bedrooms *</label>
                      <select id="property-bedrooms" required class="sans-body" style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color};">
                        <option value="0">Self-Contained (Studio)</option>
                        <option value="1">1 Bedroom</option>
                        <option value="2">2 Bedrooms</option>
                        <option value="3">3 Bedrooms</option>
                        <option value="4">4 Bedrooms</option>
                        <option value="5">5+ Bedrooms</option>
                      </select>
                    </div>

                    <div>
                      <label for="property-bathrooms" class="sans-body" style="display: block; font-size: ${baseSize * 0.875}px; font-weight: 600; margin-bottom: 8px; color: ${config.text_color};">Bathrooms *</label>
                      <input id="property-bathrooms" type="number" required min="1" max="10" placeholder="1" class="sans-body" style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color};" />
                    </div>

                    <div>
                      <label for="property-sqft" class="sans-body" style="display: block; font-size: ${baseSize * 0.875}px; font-weight: 600; margin-bottom: 8px; color: ${config.text_color};">Square Feet *</label>
                      <input id="property-sqft" type="number" required min="100" step="50" placeholder="1000" class="sans-body" style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color};" />
                    </div>
                  </div>

                  <div style="margin-bottom: 32px;">
                    <label for="property-description" class="sans-body" style="display: block; font-size: ${baseSize * 0.875}px; font-weight: 600; margin-bottom: 8px; color: ${config.text_color};">Description *</label>
                    <textarea id="property-description" required placeholder="Describe your property..." class="sans-body" style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color}; min-height: 150px; resize: vertical;"></textarea>
                  </div>

                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px; margin-bottom: 32px;">
                    <div>
                      <label for="property-agent" class="sans-body" style="display: block; font-size: ${baseSize * 0.875}px; font-weight: 600; margin-bottom: 8px; color: ${config.text_color};">Agent Name *</label>
                      <input id="property-agent" type="text" required placeholder="Your name" class="sans-body" style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color};" />
                    </div>

                    <div>
                      <label for="property-phone" class="sans-body" style="display: block; font-size: ${baseSize * 0.875}px; font-weight: 600; margin-bottom: 8px; color: ${config.text_color};">Phone *</label>
                      <input id="property-phone" type="tel" required placeholder="(555) 123-4567" class="sans-body" style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color};" />
                    </div>


                       <div class="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Bedrooms</label>
                            <input type="number" id="property-beds" class="w-full p-2 border border-slate-300 rounded-lg" placeholder="6" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Bathrooms</label>
                            <input type="number" id="property-baths" class="w-full p-2 border border-slate-300 rounded-lg" placeholder="7" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Sqft (Area)</label>
                            <input type="number" id="property-sqft" class="w-full p-2 border border-slate-300 rounded-lg" placeholder="7200" required>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Agent Name</label>
                            <input type="text" id="agent-name" class="w-full p-2 border border-slate-300 rounded-lg" placeholder="Sophia Laurent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Agent Phone</label>
                            <input type="text" id="agent-phone" class="w-full p-2 border border-slate-300 rounded-lg" placeholder="+234...">
                        </div>
                    </div>







                    <div>
                      <label for="property-email" class="sans-body" style="display: block; font-size: ${baseSize * 0.875}px; font-weight: 600; margin-bottom: 8px; color: ${config.text_color};">Email *</label>
                      <input id="property-email" type="email" required placeholder="your@email.com" class="sans-body" style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color};" />
                    </div>
                  </div>

                  <button type="submit" ${isSubmitting ? 'disabled' : ''} class="sans-body" style="width: 100%; padding: 18px; background: ${config.primary_action}; color: white; border: none; border-radius: 12px; font-size: ${baseSize * 1.125}px; font-weight: 700; cursor: ${isSubmitting ? 'not-allowed' : 'pointer'}; opacity: ${isSubmitting ? '0.6' : '1'};">
                    ${isSubmitting ? 'Submitting...' : 'Submit Property'}
                  </button>
                </form>
              </div>
            </div>
          </div>
        `;
      } else {
        content += `
          <div style="background: ${config.background_color};">
            <div class="hero-gradient" style="padding: 80px 24px; text-align: center;">
              <div style="max-width: 900px; margin: 0 auto;">
                <h1 class="serif-heading" style="font-size: ${baseSize * 3.5}px; font-weight: 800; margin: 0 0 20px 0; color: white; line-height: 1.2;">${config.hero_headline || defaultConfig.hero_headline}</h1>
                <p class="sans-body" style="font-size: ${baseSize * 1.25}px; color: white; opacity: 0.95; margin: 0 0 40px 0;">${config.site_tagline || defaultConfig.site_tagline}</p>
                
                <div style="background: rgba(255,255,255,0.95); padding: 20px; border-radius: 16px; backdrop-filter: blur(10px); box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
                <div style="display: flex; gap: 12px; align-items: center;">
                  <input 
                    id="ai-search-input" 
                    type="text" 
                    placeholder="${config.search_placeholder || defaultConfig.search_placeholder}" 
                    class="sans-body" 
                    value="${currentFilters.aiSearch}" 
                    style="flex: 1; padding: 18px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: ${baseSize * 1.0625}px; color: ${config.text_color}; outline: none; transition: border-color 0.2s;" 
                    onfocus="this.style.borderColor='${config.primary_action}'" 
                    onblur="this.style.borderColor='#e5e7eb'" 
                  />
                  <button 
                    id="search-btn" onclick="handleSearch()"
                    style="background: ${config.primary_action}; color: white; padding: 0 24px; height: 60px; border-radius: 12px; border: none; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: opacity 0.2s;"
                    onmouseover="this.style.opacity='0.9'"
                    onmouseout="this.style.opacity='1'"
                  >
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="11" cy="11" r="8"></circle>
                      <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    Search
                  </button>
                </div>
              </div>
              </div>
            </div>

            <div style="max-width: 1400px; margin: 0 auto; padding: 40px 24px 80px 24px;">
              <div style="background: ${config.card_background}; padding: 24px; border-radius: 16px; margin-bottom: 40px;">
                <h3 class="serif-heading" style="font-size: ${baseSize * 1.25}px; font-weight: 700; margin: 0 0 20px 0; color: ${config.text_color};">${config.filter_title || defaultConfig.filter_title}</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                  <div>
                    <label class="sans-body" style="font-size: ${baseSize * 0.875}px; color: ${config.text_color}; display: block; margin-bottom: 8px; font-weight: 600;">Bedrooms</label>
                    <select onchange="setFilter('bedrooms', this.value)" class="sans-body" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color};">
                      <option value="all" ${currentFilters.bedrooms === 'all' ? 'selected' : ''}>All Bedrooms</option>
                      <option value="self-contained" ${currentFilters.bedrooms === 'self-contained' ? 'selected' : ''}>Self-Contained Room</option>
                      <option value="1" ${currentFilters.bedrooms === '1' ? 'selected' : ''}>1 Bedroom</option>
                      <option value="2" ${currentFilters.bedrooms === '2' ? 'selected' : ''}>2 Bedrooms</option>
                      <option value="3" ${currentFilters.bedrooms === '3' ? 'selected' : ''}>3 Bedrooms</option>
                      <option value="4" ${currentFilters.bedrooms === '4' ? 'selected' : ''}>4+ Bedrooms</option>
                    </select>
                  </div>

                  <div>
                    <label class="sans-body" style="font-size: ${baseSize * 0.875}px; color: ${config.text_color}; display: block; margin-bottom: 8px; font-weight: 600;">Price Range</label>
                    <select onchange="setFilter('priceRange', this.value)" class="sans-body" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color};">
                      <option value="all" ${currentFilters.priceRange === 'all' ? 'selected' : ''}>All Prices</option>
                      <option value="low" ${currentFilters.priceRange === 'low' ? 'selected' : ''}>Budget (< â‚¦50M / < â‚¦300k/mo)</option>
                      <option value="medium" ${currentFilters.priceRange === 'medium' ? 'selected' : ''}>Mid-Range (â‚¦50M-â‚¦150M / â‚¦300k-â‚¦600k/mo)</option>
                      <option value="high" ${currentFilters.priceRange === 'high' ? 'selected' : ''}>Luxury (> ï¿½ï¿½ï¿½ï¿½ï¿½150M / > â‚¦600k/mo)</option>
                    </select>
                  </div>

                  <div>
                    <label class="sans-body" style="font-size: ${baseSize * 0.875}px; color: ${config.text_color}; display: block; margin-bottom: 8px; font-weight: 600;">Type</label>
                    <select onchange="setFilter('type', this.value)" class="sans-body" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color};">
                      <option value="all" ${currentFilters.type === 'all' ? 'selected' : ''}>All</option>
                      <option value="rent" ${currentFilters.type === 'rent' ? 'selected' : ''}>For Rent</option>
                      <option value="sale" ${currentFilters.type === 'sale' ? 'selected' : ''}>For Sale</option>
                    </select>
                  </div>

                  <div>
                    <label class="sans-body" style="font-size: ${baseSize * 0.875}px; color: ${config.text_color}; display: block; margin-bottom: 8px; font-weight: 600;">Area Type</label>
                    <select onchange="setFilter('location', this.value)" class="sans-body" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color};">
                      <option value="all" ${currentFilters.location === 'all' ? 'selected' : ''}>All Areas</option>
                      <option value="City Center" ${currentFilters.location === 'City Center' ? 'selected' : ''}>City Center</option>
                      <option value="Residential" ${currentFilters.location === 'Residential' ? 'selected' : ''}>Residential</option>
                      <option value="University Area" ${currentFilters.location === 'University Area' ? 'selected' : ''}>University Area</option>
                      <option value="Waterfront" ${currentFilters.location === 'Waterfront' ? 'selected' : ''}>Waterfront</option>
                    </select>
                  </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                  <div>
                    <label class="sans-body" style="font-size: ${baseSize * 0.875}px; color: ${config.text_color}; display: block; margin-bottom: 8px; font-weight: 600;">City</label>
                    <input type="text" placeholder="Search by city..." class="sans-body" value="${currentFilters.citySearch}" oninput="setFilter('citySearch', this.value)" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color};" />
                  </div>

                  <div>
                    <label class="sans-body" style="font-size: ${baseSize * 0.875}px; color: ${config.text_color}; display: block; margin-bottom: 8px; font-weight: 600;">State</label>
                    <input type="text" placeholder="Search by state..." class="sans-body" value="${currentFilters.stateSearch}" oninput="setFilter('stateSearch', this.value)" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color};" />
                  </div>

                  <div>
                    <label class="sans-body" style="font-size: ${baseSize * 0.875}px; color: ${config.text_color}; display: block; margin-bottom: 8px; font-weight: 600;">Sort By</label>
                    <select onchange="setSort(this.value)" class="sans-body" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color}; background: ${config.background_color};">
                      <option value="featured" ${sortBy === 'featured' ? 'selected' : ''}>Featured</option>
                      <option value="price-low" ${sortBy === 'price-low' ? 'selected' : ''}>Price: Low to High</option>
                      <option value="price-high" ${sortBy === 'price-high' ? 'selected' : ''}>Price: High to Low</option>
                      <option value="newest" ${sortBy === 'newest' ? 'selected' : ''}>Newest</option>
                    </select>
                  </div>
                </div>
              </div>

              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; flex-wrap: wrap; gap: 16px;">
                <h2 class="serif-heading" style="font-size: ${baseSize * 2}px; font-weight: 700; margin: 0; color: ${config.text_color};">
                  ${filteredProps.length} ${filteredProps.length === 1 ? 'Property' : 'Properties'} Found
                </h2>
              </div>
              <div id="properties"></div>

              <section class="py-12 bg-slate-50">
                <div class="container mx-auto px-4">
                <h2 class="text-3xl font-bold mb-8">Latest Live Listings</h2>
                <div id="properties-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                </div>
                </div>
               </section>


              ${filteredProps.length === 0 ? `
                <div style="text-align: center; padding: 80px 24px;">
                  <p class="sans-body" style="font-size: ${baseSize * 1.25}px; color: ${config.text_color}; opacity: 0.6; margin: 0;">No properties match your search criteria. Try adjusting your filters.</p>
                </div>
              ` : `
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 32px;">
                  ${filteredProps.map(prop => {
                    const propImages = prop.images && prop.images.length >= 8 ? prop.images : generatePropertyImages(prop.id, ['#3b82f6', '#2563eb', '#1d4ed8', '#1e40af', '#1e3a8a']);
                    const propWithImages = {...prop, images: propImages};
                    return `
                    <div class="property-card" style="background: ${config.card_background}; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.06); position: relative;">
                      ${prop.featured ? `
                        <div style="position: absolute; top: 16px; right: 16px; z-index: 10;">
                          <span class="sans-body" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 6px 14px; border-radius: 8px; font-size: ${baseSize * 0.75}px; font-weight: 700; text-transform: uppercase;">Featured</span>
                        </div>
                      ` : ''}
                      
                      <div class="carousel-container" onclick="event.stopPropagation(); switchView('property', ${JSON.stringify(propWithImages).replace(/"/g, '&quot;')})">
                        <div id="carousel-slides-${prop.id}" class="carousel-slides">
                          ${propImages.slice(0, 8).map(img => `
                            <div class="carousel-slide">
                              <img src="${img}" alt="${prop.title}" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.src=''; this.alt='Image failed to load';" />
                            </div>
                          `).join('')}
                        </div>




                        
                        <button class="carousel-arrow carousel-arrow-left" onclick="event.stopPropagation(); carouselPrev(${prop.id}, 8)">â€¹</button>
                        <button class="carousel-arrow carousel-arrow-right" onclick="event.stopPropagation(); carouselNext(${prop.id}, 8)">â€º</button>
                        <div id="carousel-dots-${prop.id}" class="carousel-dots">
                          ${propImages.slice(0, 8).map((_, index) => `
                            <div class="carousel-dot ${index === 0 ? 'active' : ''}" onclick="event.stopPropagation(); goToSlide(${prop.id}, ${index}, 8)"></div>
                          `).join('')}
                        </div>
                      </div>

                      <div style="padding: 20px;" onclick="switchView('property', ${JSON.stringify(propWithImages).replace(/"/g, '&quot;')})">
                        <h3 class="serif-heading" style="font-size: ${baseSize * 1.125}px; font-weight: 700; margin: 0 0 8px 0; color: ${config.text_color};">${prop.title}</h3>
                        <p class="serif-heading" style="font-size: ${baseSize * 1.25}px; font-weight: 700; color: ${config.primary_action}; margin: 0 0 8px 0;">${formatPrice(prop.price, prop.type)}</p>
                        <p class="sans-body" style="font-size: ${baseSize * 0.75}px; color: ${config.text_color}; opacity: 0.7; margin: 0 0 8px 0;">ï¿½ï¿½ ${prop.city}, ${prop.state}</p>
                        <p class="sans-body" style="font-size: ${baseSize * 0.75}px; color: ${config.text_color}; opacity: 0.7; margin: 0 0 12px 0;">${prop.bedrooms === 0 ? 'ðŸ  Self-Contained' : `ðŸ›ï¸ ${prop.bedrooms} beds`} â€¢ ðŸš¿ ${prop.bathrooms} baths â€¢ ðŸ“ ${prop.sqft.toLocaleString()} sqft</p>


                        
                        <div style="border-top: 1px solid #e5e7eb; padding-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                          <p class="sans-body" style="font-size: ${baseSize * 0.75}px; color: #6b7280; margin: 0 0 2px 0;">Agent</p>



                          
                          
                          <div style="display: flex; flex-direction: column;">
                            <p class="sans-body" style="font-size: ${baseSize * 0.875}px; color: ${config.text_color}; font-weight: 600; margin: 0; display: flex; align-items: center;">
                              ${prop.agent}
                              ${prop.is_verified ? `
                                <span style="margin-left: 4px; color: #3b82f6; display: flex; cursor: help;" title="Verified on ${new Date(prop.verified_date).toLocaleDateString()}">
                                  <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M23 12l-2.44-2.79.34-3.69-3.61-.82-1.89-3.2L12 2.96 8.6 1.5 6.71 4.7l-3.61.81.34 3.7L1 12l2.44 2.79-.34 3.69 3.61.82 1.89 3.2L12 21.04l3.4 1.46 1.89-3.2 3.61-.82-.34-3.69L23 12zm-12.91 4.72l-3.8-3.81 1.48-1.48 2.32 2.33 5.85-5.87 1.48 1.48-7.33 7.35z"/></svg>
                                </span>` : ''}
                            </p>
                            
                            <div style="font-size: 12px; display: flex; align-items: center; gap: 4px; margin-top: 2px;">
                              ${renderStars(prop.rating || 5)} 
                              <span style="color: #6b7280; font-weight: 500;">(${prop.rating || '5.0'})</span>
                            </div>
                          </div>
                        </div>
                        
                        <button onclick="..." style="...">ðŸ“§ Contact</button>
                      </div>
                      </div>
                    </div>                    
                  `;
                  }).join('')}
                </div>
              `}
            </div>
          </div>
        `;
      }


        function previewImages(event) {
          const container = document.getElementById('image-preview-container');
          container.innerHTML = ''; 
          const files = event.target.files;

          if (files.length > 8) {
              alert("Please only select 8 images maximum.");
              event.target.value = ''; 
              return;
          }

          Array.from(files).forEach(file => {
              const reader = new FileReader();
              reader.onload = function(e) {
                  const img = document.createElement('img');
                  img.src = e.target.result;
                  img.style.cssText = "width: 70px; height: 70px; object-fit: cover; border-radius: 6px; border: 1px solid #ddd;";
                  container.appendChild(img);
              }
              reader.readAsDataURL(file);
          });
      }



      

      content += renderFooter(config, baseSize);

      // Add chat widget
      content += `
        <div class="chat-widget">
          ${chatOpen ? `
            <div class="chat-window">
              <div class="chat-header">
                <div>
                  <h3 style="margin: 0; font-size: ${baseSize * 1.125}px; font-weight: 700;">Live Support</h3>
                  <p style="margin: 4px 0 0 0; font-size: ${baseSize * 0.75}px; opacity: 0.9;">We typically reply instantly</p>
                </div>
                <button onclick="toggleChat()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='none'">Ã—</button>
              </div>
              
              <div id="chat-messages" class="chat-messages">
                ${chatMessages.map(msg => `
                  <div class="chat-message ${msg.type}">
                    ${msg.type === 'agent' ? `
                      <div class="message-avatar">CS</div>
                    ` : ''}
                    <div>
                      <div class="message-content">
                        ${msg.text}
                        <div class="message-time">${msg.time}</div>
                      </div>
                      ${msg.showQuickReplies ? `
                        <div class="quick-replies">
                          <button class="quick-reply-button" onclick="sendQuickReply('I want to buy a property')">ðŸ  Buy Property</button>
                          <button class="quick-reply-button" onclick="sendQuickReply('I want to rent a property')">ðŸ”‘ Rent Property</button>
                          <button class="quick-reply-button" onclick="sendQuickReply('Schedule a tour')">ðŸ“… Schedule Tour</button>
                          <button class="quick-reply-button" onclick="sendQuickReply('Talk to an agent')">ðŸ‘¤ Talk to Agent</button>
                        </div>
                      ` : ''}
                    </div>
                    ${msg.type === 'user' ? `
                      <div class="message-avatar">You</div>
                    ` : ''}
                  </div>
                `).join('')}
                
                ${isTyping ? `
                  <div class="chat-message agent">
                    <div class="message-avatar">CS</div>
                    <div class="typing-indicator">
                      <div class="typing-dot"></div>
                      <div class="typing-dot"></div>
                      <div class="typing-dot"></div>
                    </div>
                  </div>
                ` : ''}
              </div>
              
              <div class="chat-input-container">
                <input 
                  id="chat-input" 
                  type="text" 
                  class="chat-input" 
                  placeholder="Type your message..." 
                  onkeypress="if(event.key === 'Enter') sendChatMessage()"
                />
                <button class="chat-send-button" onclick="sendChatMessage()">
                  âž¤
                </button>
              </div>
            </div>
          ` : ''}
          
          <button class="chat-button ${hasUnreadMessages ? 'unread' : ''}" onclick="toggleChat()" title="Live Chat Support">
            ðŸ’¬
          </button>
        </div>
      `;

      const appElement = document.getElementById('app');
      appElement.innerHTML = content;
      appElement.style.fontFamily = `${customFont}, ${customFont === 'Inter' ? 'sans-serif' : 'serif'}`;
      
      // Restore focus state
      if (wasSearchFocused && currentView === 'listings') {
        const searchInput = document.getElementById('ai-search-input');
        if (searchInput) {
          searchInput.focus();
          searchInput.setSelectionRange(cursorPosition, cursorPosition);
        }
      }
      
      // Initialize carousels after DOM is updated
      if (currentView === 'listings') {
        setTimeout(() => {
          filteredProps.forEach(prop => {
            initCarousel(prop.id, 8);
          });
        }, 100);
      }

      // Initialize map and carousel for property detail view
      if (currentView === 'property' && selectedProperty) {
        setTimeout(() => {
          initCarousel('detail', 8);
          initPropertyMap(selectedProperty);
        }, 100);
      }
    }

    function initPropertyMap(property) {
      const mapContainer = document.getElementById('property-map');
      if (!mapContainer || !property.lat || !property.lng) return;

      const lat = property.lat;
      const lng = property.lng;
      const zoom = 14;

      // Use OpenStreetMap tiles
      mapContainer.innerHTML = `
        <div id="map-view" style="width: 100%; height: 100%; position: relative; overflow: hidden; background: #f0f0f0; cursor: grab;">
          <img id="map-tile" src="" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; user-select: none;" draggable="false" />
          <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -100%); z-index: 10; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));">
            <svg width="40" height="50" viewBox="0 0 40 50" xmlns="http://www.w3.org/2000/svg">
              <path d="M20 0C9 0 0 9 0 20c0 15 20 30 20 30s20-15 20-30C40 9 31 0 20 0z" fill="#2563eb"/>
              <circle cx="20" cy="20" r="8" fill="white"/>
            </svg>
          </div>
          <div style="position: absolute; bottom: 16px; right: 16px; display: flex; flex-direction: column; gap: 8px; z-index: 10;">
            <button onclick="zoomIn()" style="width: 40px; height: 40px; background: white; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; font-size: 20px; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">+</button>
            <button onclick="zoomOut()" style="width: 40px; height: 40px; background: white; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; font-size: 20px; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">âˆ’</button>
          </div>
          <div style="position: absolute; bottom: 8px; left: 8px; background: rgba(255,255,255,0.9); padding: 4px 8px; border-radius: 4px; font-size: 11px; z-index: 10;">
            <a href="https://www.openstreetmap.org" target="_blank" rel="noopener noreferrer" style="color: #0078a8; text-decoration: none;">Â© OpenStreetMap</a>
          </div>
        </div>
      `;

      let currentZoom = zoom;
      let currentLat = lat;
      let currentLng = lng;
      let isDragging = false;
      let startX, startY, startLat, startLng;

      function updateMap() {
        const tile = document.getElementById('map-tile');
        if (tile) {
          // Use OpenStreetMap tile server
          const tileZoom = Math.floor(currentZoom);
          const scale = Math.pow(2, tileZoom);
          const tileX = Math.floor((currentLng + 180) / 360 * scale);
          const tileY = Math.floor((1 - Math.log(Math.tan(currentLat * Math.PI / 180) + 1 / Math.cos(currentLat * Math.PI / 180)) / Math.PI) / 2 * scale);
          
          // Create a 3x3 grid of tiles for better coverage
          const canvas = document.createElement('canvas');
          canvas.width = 768;
          canvas.height = 768;
          const ctx = canvas.getContext('2d');
          
          let loadedTiles = 0;
          const totalTiles = 9;
          
          for (let dx = -1; dx <= 1; dx++) {
            for (let dy = -1; dy <= 1; dy++) {
              const img = new Image();
              img.crossOrigin = 'anonymous';
              img.onload = function() {
                ctx.drawImage(img, (dx + 1) * 256, (dy + 1) * 256, 256, 256);
                loadedTiles++;
                if (loadedTiles === totalTiles) {
                  tile.src = canvas.toDataURL();
                }
              };
              img.onerror = function() {
                loadedTiles++;
                if (loadedTiles === totalTiles) {
                  tile.src = canvas.toDataURL();
                }
              };
              img.src = `https://tile.openstreetmap.org/${tileZoom}/${tileX + dx}/${tileY + dy}.png`;
            }
          }
        }
      }

      window.zoomIn = function() {
        if (currentZoom < 18) {
          currentZoom += 1;
          updateMap();
        }
      };

      window.zoomOut = function() {
        if (currentZoom > 3) {
          currentZoom -= 1;
          updateMap();
        }
      };

      const mapView = document.getElementById('map-view');
      if (mapView) {
        mapView.addEventListener('mousedown', (e) => {
          isDragging = true;
          startX = e.clientX;
          startY = e.clientY;
          startLat = currentLat;
          startLng = currentLng;
          mapView.style.cursor = 'grabbing';
        });

        mapView.addEventListener('mousemove', (e) => {
          if (isDragging) {
            const deltaX = e.clientX - startX;
            const deltaY = e.clientY - startY;
            
            const scale = Math.pow(2, currentZoom);
            const metersPerPixel = 156543.03392 * Math.cos(startLat * Math.PI / 180) / scale;
            const earthCircumference = 40075017;
            
            currentLng = startLng - (deltaX * metersPerPixel / (earthCircumference / 360));
            currentLat = startLat + (deltaY * metersPerPixel / (earthCircumference / 360));
            
            // Clamp latitude
            currentLat = Math.max(-85, Math.min(85, currentLat));
            
            updateMap();
          }
        });

        mapView.addEventListener('mouseup', () => {
          isDragging = false;
          mapView.style.cursor = 'grab';
        });

        mapView.addEventListener('mouseleave', () => {
          if (isDragging) {
            isDragging = false;
            mapView.style.cursor = 'grab';
          }
        });

        // Touch support for mobile
        mapView.addEventListener('touchstart', (e) => {
          const touch = e.touches[0];
          isDragging = true;
          startX = touch.clientX;
          startY = touch.clientY;
          startLat = currentLat;
          startLng = currentLng;
        });

        mapView.addEventListener('touchmove', (e) => {
          if (isDragging && e.touches.length === 1) {
            e.preventDefault();
            const touch = e.touches[0];
            const deltaX = touch.clientX - startX;
            const deltaY = touch.clientY - startY;
            
            const scale = Math.pow(2, currentZoom);
            const metersPerPixel = 156543.03392 * Math.cos(startLat * Math.PI / 180) / scale;
            const earthCircumference = 40075017;
            
            currentLng = startLng - (deltaX * metersPerPixel / (earthCircumference / 360));
            currentLat = startLat + (deltaY * metersPerPixel / (earthCircumference / 360));
            
            currentLat = Math.max(-85, Math.min(85, currentLat));
            
            updateMap();
          }
        });

        mapView.addEventListener('touchend', () => {
          isDragging = false;
        });
      }

      updateMap();
    }

    async function onConfigChange(config) {
      render();
    }

    const dataHandler = {
      onDataChanged(data) {
        userSubmittedProperties = data;
        render();
      }
    };

    async function init() {
      if (window.elementSdk) {
        await window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.background_color || defaultConfig.background_color,
                set: (value) => {
                  config.background_color = value;
                  window.elementSdk.setConfig({ background_color: value });
                }
              },
              {
                get: () => config.card_background || defaultConfig.card_background,
                set: (value) => {
                  config.card_background = value;
                  window.elementSdk.setConfig({ card_background: value });
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                }
              },
              {
                get: () => config.primary_action || defaultConfig.primary_action,
                set: (value) => {
                  config.primary_action = value;
                  window.elementSdk.setConfig({ primary_action: value });
                }
              },
              {
                get: () => config.accent_color || defaultConfig.accent_color,
                set: (value) => {
                  config.accent_color = value;
                  window.elementSdk.setConfig({ accent_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                config.font_family = value;
                window.elementSdk.setConfig({ font_family: value });
              }
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                config.font_size = value;
                window.elementSdk.setConfig({ font_size: value });
              }
            }
          }),
          mapToEditPanelValues: (config) => new Map([
            ['logo_text', config.logo_text || defaultConfig.logo_text],
            ['site_title', config.site_title || defaultConfig.site_title],
            ['site_tagline', config.site_tagline || defaultConfig.site_tagline],
            ['hero_headline', config.hero_headline || defaultConfig.hero_headline],
            ['primary_cta', config.primary_cta || defaultConfig.primary_cta],
            ['secondary_cta', config.secondary_cta || defaultConfig.secondary_cta],
            ['search_placeholder', config.search_placeholder || defaultConfig.search_placeholder],
            ['filter_title', config.filter_title || defaultConfig.filter_title],
            ['company_tagline', config.company_tagline || defaultConfig.company_tagline],
            ['footer_about', config.footer_about || defaultConfig.footer_about],
            ['contact_address', config.contact_address || defaultConfig.contact_address],
            ['contact_phone', config.contact_phone || defaultConfig.contact_phone],
            ['contact_email', config.contact_email || defaultConfig.contact_email]
          ])
        });
      }

      if (window.dataSdk) {
        const initResult = await window.dataSdk.init(dataHandler);
        if (!initResult.isOk) {
          console.error("Failed to initialize data SDK");
        }
      }

      render();
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b07b21c70c96373',t:'MTc2NjE1NTY1Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script> 



    <script>

      // 1. UNIFIED LOAD FUNCTION
          async function loadProperties(searchTerm = '') {
              try {
                  const grid = document.getElementById('properties-grid');
                  if (!grid) return;

                  grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 20px;">Fetching Live Properties...</div>';

                  // Fetch from Supabase
                  let query = window.supabase
                      .from('properties')
                      .select('*')
                      .eq('approved', true);

                  if (searchTerm) {
                      query = query.or(`location.ilike.%${searchTerm}%,title.ilike.%${searchTerm}%,city.ilike.%${searchTerm}%`);
                  }

                  const { data, error } = await query.order('created_at', { ascending: false });
                  if (error) throw error;

                  if (!data || data.length === 0) {
                      grid.innerHTML = `<div style="grid-column: 1/-1; text-align: center; padding: 40px;"><h3>No live properties found.</h3></div>`;
                      return;
                  }

                  // 2. RENDER USING THE EXACT SAME CARD LOGIC
                  grid.innerHTML = data.map(prop => {
                      // Ensure images is always an array for swiping
                      const images = Array.isArray(prop.images) && prop.images.length > 0 
                                    ? prop.images 
                                    : [prop.image_url];
                      
                      const carouselId = `carousel_${prop.id}`;

                      // Set auto-swipe timer
                      setTimeout(() => {
                          const track = document.getElementById(`track-${carouselId}`);
                          if (track && images.length > 1) {
                              let currentIndex = 0;
                              setInterval(() => {
                                  currentIndex = (currentIndex + 1) % images.length;
                                  track.style.transform = `translateX(-${currentIndex * 100}%)`;
                              }, 2000);
                          }
                      }, 500);

                      return `
<a href="property-details.html?id=${prop.id}" 
   class="block bg-white rounded-xl shadow-lg overflow-hidden border border-slate-100 transition-transform hover:scale-[1.01] hover:shadow-xl cursor-pointer">

    <div class="relative h-64 overflow-hidden group">
        <div id="track-${carouselId}" style="display: flex; width: 100%; height: 100%; transition: transform 0.7s ease-in-out;">
            ${images.map(img => `<img src="${img}" class="w-full h-full flex-shrink-0 object-cover">`).join('')}
        </div>

        <span class="absolute top-4 right-4 px-3 py-1 bg-orange-500 text-white text-xs font-bold rounded uppercase tracking-wider z-10">
            FEATURED
        </span>

        <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-1 z-10">
            ${images.map((_, i) => `<div class="w-1.5 h-1.5 rounded-full bg-white/${i===0?'100':'50'}"></div>`).join('')}
        </div>
    </div>

    <div class="p-6">
        <h3 class="text-xl font-bold text-slate-800 mb-2 truncate">${prop.title}</h3>

        <p class="text-blue-600 text-2xl font-bold mb-3">
            â‚¦${Number(prop.price).toLocaleString()}
        </p>

        <p class="text-slate-500 text-sm mb-4">
            <i class="fas fa-map-marker-alt mr-2"></i> ${prop.location}
        </p>

        <div class="flex items-center gap-4 text-slate-600 text-sm mb-6">
            <span class="flex items-center gap-1"><i class="fas fa-bed"></i> ${prop.bedrooms || 0} beds</span>
            <span class="flex items-center gap-1"><i class="fas fa-bath"></i> ${prop.bathrooms || 0} baths</span>
            <span class="flex items-center gap-1"><i class="fas fa-expand"></i> ${Number(prop.sqft || 0).toLocaleString()} sqft</span>
        </div>

        <div class="pt-4 border-t border-slate-100 flex items-center justify-between">
            <div class="flex flex-col">
                <span class="text-xs text-slate-400">Agent</span>
                <div class="flex items-center gap-1">
                    <span class="font-bold text-slate-800">
                        ${prop.agent_name || 'Verified Agent'}
                    </span>
                    ${prop.is_verified ? '<i class="fas fa-check-circle text-blue-500 text-[10px]"></i>' : ''}
                </div>
            </div>

            <span class="px-4 py-2 border border-slate-200 rounded-lg text-sm font-semibold hover:bg-slate-50 transition">
                View Details
            </span>
        </div>
    </div>
</a>
`;

                  }).join('');

              } catch (err) {
                  console.error("Layout Error:", err.message);
              }
          }

          // Initialize on page load
          window.loadProperties = loadProperties;
          document.addEventListener('DOMContentLoaded', () => loadProperties(''));


           async function submitProperty(imageUrls) {
              const propertyData = {
                  title: document.getElementById('property-title').value,
                  price: parseFloat(document.getElementById('property-price').value) || 0,
                  type: document.getElementById('property-type')?.value || 'Sale',
                  location: document.getElementById('property-location').value,
                  city: document.getElementById('property-city').value,
                  state: document.getElementById('property-state')?.value || "",
                  
                  // Handling numbers to prevent "0" display errors
                  bedrooms: parseInt(document.getElementById('property-bedrooms')?.value) || 0,
                  bathrooms: parseInt(document.getElementById('property-bathrooms')?.value) || 0,
                  sqft: parseInt(document.getElementById('property-sqft')?.value) || 0,
                  
                  description: document.getElementById('property-description')?.value || "",
                  agent_name: document.getElementById('property-agent')?.value || "Luxe Estates",
                  phone: document.getElementById('property-phone')?.value || "",

                  // Multiple Image Support
                  images: imageUrls, 
                  image_url: imageUrls[0], // Main thumbnail (first image of the 8)
                  
                  approved: false,
                  status: 'Available'
              };

              try {
                  if (!window.supabase) throw new Error("Database not connected");

                  const { error } = await window.supabase.from('properties').insert([propertyData]);
                  
                  if (error) throw error;
                  
                  alert("Successfully uploaded " + imageUrls.length + " images! Listing is pending approval.");
                  location.reload(); // Refresh to clear form
              } catch (err) {
                  console.error("Submission Error:", err.message);
                  alert("Database error: " + err.message);
              }
          }




        // Listen for changes in the properties table
                function connectRealtime() {
            if (window.supabase && typeof window.supabase.channel === 'function') {
                window.supabase
                    .channel('public:properties')
                    .on('postgres_changes', { event: '*', schema: 'public', table: 'properties' }, payload => {
                        console.log('Change received!', payload);
                        if (typeof loadProperties === 'function') loadProperties();
                    })
                    .subscribe();
                console.log("âœ… Real-time connected!");
            } else {
                setTimeout(connectRealtime, 500);
            }
        }
        connectRealtime();

            async function uploadAndSubmit() {
                const fileInput = document.getElementById('property-images');
                const files = Array.from(fileInput.files);

                if (files.length === 0) {
                    alert("Please select at least one image.");
                    return;
                }
                
                if (files.length > 8) {
                    alert("Maximum 8 images allowed.");
                    return;
                }

                try {
                    const imageUrls = []; // This will hold all 8 URLs

                    // We use a for...of loop to upload each file in the list
                    for (const file of files) {
                        const fileExt = file.name.split('.').pop();
                        const fileName = `${Math.random()}-${Date.now()}.${fileExt}`;
                        const filePath = `property-images/${fileName}`;

                        // 1. Upload the current file
                        const { error: uploadError } = await window.supabase.storage
                            .from('properties')
                            .upload(filePath, file);

                        if (uploadError) throw uploadError;

                        // 2. Get the URL for this specific file
                        const { data: { publicUrl } } = window.supabase.storage
                            .from('properties')
                            .getPublicUrl(filePath);

                        // 3. Add this URL to our list
                        imageUrls.push(publicUrl);
                    }

                    // 4. Send the WHOLE ARRAY of URLs to the submission logic
                    await submitProperty(imageUrls);

                } catch (err) {
                    console.error("Upload failed:", err.message);
                    alert("Upload error: " + err.message);
                }
            }
        //</script>


            <script>
          // This waits until the page is fully loaded
          window.addEventListener('load', function() {
            const btn = document.getElementById('search-btn');
            const input = document.getElementById('ai-search-input');

            if (btn) {
              btn.onclick = function() {
                const query = input.value.trim();
                console.log("Forcing search for:", query);
                
                // This clears the grid and shows the searching text immediately
                const grid = document.getElementById('properties-grid');
                if (grid) grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 20px; font-size: 20px;">Searching...</div>';
                
                // Call the main function
                if (typeof loadProperties === 'function') {
                  loadProperties(query);
                }
              };
            }

            // Support for the Enter key
            if (input) {
              input.onkeypress = function(e) {
                if (e.key === 'Enter') btn.click();
              };
            }
          });
        </script>



        <script>
          window.handleSearch = function() {
            const input = document.getElementById('ai-search-input');
            const grid = document.getElementById('properties-grid');
            
            if (input && grid) {
              const query = input.value.trim().toLowerCase();
              
              // 1. SHOW LOADING STATE IMMEDIATELY
              grid.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 60px;">
                    <div class="loader" style="font-size: 40px; margin-bottom: 20px; animation: spin 2s linear infinite;">âŒ›</div>
                    <h3 style="font-size: 20px; font-weight: 600; color: #64748b;">Searching all listings...</h3>
                </div>`;

              // 2. MERGE BOTH DATA SOURCES
              // 'properties' is your default list, 'userSubmittedProperties' is from Supabase
              const allAvailable = [...properties, ...userSubmittedProperties];

              // 3. FILTER LOGIC
              const filteredResults = allAvailable.filter(prop => {
                return prop.title.toLowerCase().includes(query) || 
                      prop.city.toLowerCase().includes(query) ||
                      prop.location.toLowerCase().includes(query);
              });

              // 4. DELAYED RENDER (To make sure user sees the search happening)
              setTimeout(() => {
                  if (filteredResults.length === 0) {
                      grid.innerHTML = `
                        <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                          <p style="color: #64748b;">No properties found. Try a different city or keyword.</p>
                        </div>`;
                  } else {
                      // Re-use your main render function to show the cards
                      // This ensures default properties are formatted correctly
                      render(); 
                  }
              }, 600);
            }
          };
        </script> 
  </body>
</html>